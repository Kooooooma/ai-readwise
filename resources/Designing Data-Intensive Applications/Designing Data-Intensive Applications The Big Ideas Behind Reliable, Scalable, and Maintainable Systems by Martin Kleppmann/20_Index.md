# **Index**

<span id="page-580-0"></span>

| A                                                                                                                                   | in stream processes, 466                                                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------|
| aborts (transactions), 222, 224                                                                                                     | aggregation pipeline query language, 48                                                                              |
| in two-phase commit, 356                                                                                                            | Agile, 22                                                                                                            |
| performance of optimistic concurrency con‐<br>trol, 266<br>retrying aborted transactions, 231<br>abstraction, 21, 27, 222, 266, 321 | minimizing irreversibility, 414, 497<br>moving faster with confidence, 532<br>Unix philosophy, 394<br>agreement, 365 |
| access path (in network model), 37, 60                                                                                              | (see also consensus)                                                                                                 |
| accidental complexity, removing, 21                                                                                                 | Airflow (workflow scheduler), 402                                                                                    |
| accountability, 535                                                                                                                 | Ajax, 131                                                                                                            |
| ACID properties (transactions), 90, 223                                                                                             | Akka (actor framework), 139                                                                                          |
| atomicity, 223, 228                                                                                                                 | algorithms                                                                                                           |
| consistency, 224, 529                                                                                                               | algorithm correctness, 308                                                                                           |
| durability, 226                                                                                                                     | B-trees, 79-83                                                                                                       |
| isolation, 225, 228                                                                                                                 | for distributed systems, 306                                                                                         |
| acknowledgements (messaging), 445                                                                                                   | hash indexes, 72-75                                                                                                  |
| active/active replication (see multi-leader repli‐                                                                                  | mergesort, 76, 402, 405                                                                                              |
| cation)                                                                                                                             | red-black trees, 78                                                                                                  |
| active/passive replication (see leader-based rep‐                                                                                   | SSTables and LSM-trees, 76-79                                                                                        |
| lication)                                                                                                                           | all-to-all replication topologies, 175                                                                               |
| ActiveMQ (messaging), 137, 444                                                                                                      | AllegroGraph (database), 50                                                                                          |
| distributed transaction support, 361                                                                                                | ALTER TABLE statement (SQL), 40, 111                                                                                 |
| ActiveRecord (object-relational mapper), 30,                                                                                        | Amazon                                                                                                               |
| 232                                                                                                                                 | Dynamo (database), 177                                                                                               |
| actor model, 138                                                                                                                    | Amazon Web Services (AWS), 8                                                                                         |
| (see also message-passing)                                                                                                          | Kinesis Streams (messaging), 448                                                                                     |
| comparison to Pregel model, 425                                                                                                     | network reliability, 279                                                                                             |
| comparison to stream processing, 468                                                                                                | postmortems, 9                                                                                                       |
| Advanced Message Queuing Protocol (see                                                                                              | RedShift (database), 93                                                                                              |
| AMQP)                                                                                                                               | S3 (object storage), 398                                                                                             |
| aerospace systems, 6, 10, 305, 372                                                                                                  | checking data integrity, 530                                                                                         |
| aggregation                                                                                                                         | amplification                                                                                                        |
| data cubes and materialized views, 101                                                                                              | of bias, 534                                                                                                         |
| in batch processes, 406                                                                                                             | of failures, 364, 495                                                                                                |

| of tail latency, 16, 207                   | Apache Storm (see Storm)                      |
|--------------------------------------------|-----------------------------------------------|
| write amplification, 84                    | Apache Tajo (see Tajo)                        |
| AMQP (Advanced Message Queuing Protocol),  | Apache Tez (see Tez)                          |
| 444                                        | Apache Thrift (see Thrift)                    |
| (see also messaging systems)               | Apache ZooKeeper (see ZooKeeper)              |
| comparison to log-based messaging, 448,    | Apama (stream analytics), 466                 |
| 451                                        | append-only B-trees, 82, 242                  |
| message ordering, 446                      | append-only files (see logs)                  |
| analytics, 90                              | Application Programming Interfaces (APIs), 5, |
| comparison to transaction processing, 91   | 27                                            |
| data warehousing (see data warehousing)    | for batch processing, 403                     |
| parallel query execution in MPP databases, | for change streams, 456                       |
| 415                                        | for distributed transactions, 361             |
| predictive (see predictive analytics)      | for graph processing, 425                     |
| relation to batch processing, 411          | for services, 131-136                         |
| schemas for, 93-95                         | (see also services)                           |
| snapshot isolation for queries, 238        | evolvability, 136                             |
| stream analytics, 466                      | RESTful, 133                                  |
| using MapReduce, analysis of user activity | SOAP, 133                                     |
| events (example), 404                      | application state (see state)                 |
| anti-caching (in-memory databases), 89     | approximate search (see similarity search)    |
| anti-entropy, 178                          | archival storage, data from databases, 131    |
| Apache ActiveMQ (see ActiveMQ)             | arcs (see edges)                              |
| Apache Avro (see Avro)                     | arithmetic mean, 14                           |
| Apache Beam (see Beam)                     | ASCII text, 119, 395                          |
| Apache BookKeeper (see BookKeeper)         | ASN.1 (schema language), 127                  |
| Apache Cassandra (see Cassandra)           | asynchronous networks, 278, 553               |
| Apache CouchDB (see CouchDB)               | comparison to synchronous networks, 284       |
| Apache Curator (see Curator)               | formal model, 307                             |
| Apache Drill (see Drill)                   | asynchronous replication, 154, 553            |
| Apache Flink (see Flink)                   | conflict detection, 172                       |
| Apache Giraph (see Giraph)                 | data loss on failover, 157                    |
| Apache Hadoop (see Hadoop)                 | reads from asynchronous follower, 162         |
| Apache HAWQ (see HAWQ)                     | Asynchronous Transfer Mode (ATM), 285         |
| Apache HBase (see HBase)                   | atomic broadcast (see total order broadcast)  |
| Apache Helix (see Helix)                   | atomic clocks (caesium clocks), 294, 295      |
| Apache Hive (see Hive)                     | (see also clocks)                             |
| Apache Impala (see Impala)                 | atomicity (concurrency), 553                  |
| Apache Jena (see Jena)                     | atomic increment-and-get, 351                 |
| Apache Kafka (see Kafka)                   | compare-and-set, 245, 327                     |
| Apache Lucene (see Lucene)                 | (see also compare-and-set operations)         |
| Apache MADlib (see MADlib)                 | replicated operations, 246                    |
| Apache Mahout (see Mahout)                 | write operations, 243                         |
| Apache Oozie (see Oozie)                   | atomicity (transactions), 223, 228, 553       |
| Apache Parquet (see Parquet)               | atomic commit, 353                            |
| Apache Qpid (see Qpid)                     | avoiding, 523, 528                            |
| Apache Samza (see Samza)                   | blocking and nonblocking, 359                 |
| Apache Solr (see Solr)                     | in stream processing, 360, 477                |
| Apache Spark (see Spark)                   | maintaining derived data, 453                 |
|                                            |                                               |

| dataflow engines, 421-423                   |
|---------------------------------------------|
| fault tolerance, 406, 414, 422, 442         |
| for data integration, 494-498               |
| graphs and iterative processing, 424-426    |
| high-level APIs and languages, 403, 426-429 |
| log-based messaging and, 451                |
| maintaining derived state, 495              |
| MapReduce and distributed filesystems,      |
| 397-413                                     |
| (see also MapReduce)                        |
| measuring performance, 13, 390              |
| outputs, 411-413                            |
| key-value stores, 412                       |
| search indexes, 411                         |
| using Unix tools (example), 391-394         |
| Bayou (database), 522                       |
| Beam (dataflow library), 498                |
| bias, 534                                   |
| big ball of mud, 20                         |
| Bigtable data model, 41, 99                 |
| binary data encodings, 115-128              |
| Avro, 122-127                               |
| MessagePack, 116-117                        |
| Thrift and Protocol Buffers, 117-121        |
| binary encoding                             |
| based on schemas, 127                       |
| by network drivers, 128                     |
| binary strings, lack of support in JSON and |
|                                             |
| XML, 114                                    |
| BinaryProtocol encoding (Thrift), 118       |
| Bitcask (storage engine), 72                |
| crash recovery, 74                          |
| Bitcoin (cryptocurrency), 532               |
| Byzantine fault tolerance, 305              |
| concurrency bugs in exchanges, 233          |
| bitmap indexes, 97                          |
| blockchains, 532                            |
| Byzantine fault tolerance, 305              |
| blocking atomic commit, 359                 |
| Bloom (programming language), 504           |
| Bloom filter (algorithm), 79, 466           |
| BookKeeper (replicated log), 372            |
| Bottled Water (change data capture), 455    |
| bounded datasets, 430, 439, 553             |
| (see also batch processing)                 |
| bounded delays, 553                         |
| in networks, 285                            |
| process pauses, 298                         |
| broadcast hash joins, 409                   |
|                                             |

| brokerless messaging, 442                     | causality, 554                         |
|-----------------------------------------------|----------------------------------------|
| Brubeck (metrics aggregator), 442             | causal ordering, 339-343               |
| BTM (transaction coordinator), 356            | linearizability and, 342               |
| bulk synchronous parallel (BSP) model, 425    | total order consistent with, 344, 345  |
| bursty network traffic patterns, 285          | consistency with, 344-347              |
| business data processing, 28, 90, 390         | consistent snapshots, 340              |
| byte sequence, encoding data in, 112          | happens-before relationship, 186       |
| Byzantine faults, 304-306, 307, 553           | in serializable transactions, 262-265  |
| Byzantine fault-tolerant systems, 305, 532    | mismatch with clocks, 292              |
| Byzantine Generals Problem, 304               | ordering events to capture, 493        |
| consensus algorithms and, 366                 | violations of, 165, 176, 292, 340      |
|                                               | with synchronized clocks, 294          |
|                                               | CEP (see complex event processing)     |
| C                                             | certificate transparency, 532          |
| caches, 89, 553                               |                                        |
| and materialized views, 101                   | chain replication, 155                 |
| as derived data, 386, 499-504                 | linearizable reads, 351                |
| database as cache of transaction log, 460     | change data capture, 160, 454          |
| in CPUs, 99, 338, 428                         | API support for change streams, 456    |
| invalidation and maintenance, 452, 467        | comparison to event sourcing, 457      |
| linearizability, 324                          | implementing, 454                      |
| CAP theorem, 336-338, 554                     | initial snapshot, 455                  |
| Cascading (batch processing), 419, 427        | log compaction, 456                    |
| hash joins, 409                               | changelogs, 460                        |
| workflows, 403                                | change data capture, 454               |
| cascading failures, 9, 214, 281               | for operator state, 479                |
| Cascalog (batch processing), 60               | generating with triggers, 455          |
| Cassandra (database)                          | in stream joins, 474                   |
| column-family data model, 41, 99              | log compaction, 456                    |
| compaction strategy, 79                       | maintaining derived state, 452         |
| compound primary key, 204                     | Chaos Monkey, 7, 280                   |
| gossip protocol, 216                          | checkpointing                          |
| hash partitioning, 203-205                    | in batch processors, 422, 426          |
|                                               | in high-performance computing, 275     |
| last-write-wins conflict resolution, 186, 292 | in stream processors, 477, 523         |
| leaderless replication, 177                   | chronicle data model, 458              |
| linearizability, lack of, 335                 | circuit-switched networks, 284         |
| log-structured storage, 78                    | circular buffers, 450                  |
| multi-datacenter support, 184                 | circular replication topologies, 175   |
| partitioning scheme, 213                      | clickstream data, analysis of, 404     |
| secondary indexes, 207                        | clients                                |
| sloppy quorums, 184                           | calling services, 131                  |
| cat (Unix tool), 391                          |                                        |
| causal context, 191                           | pushing state changes to, 512          |
| (see also causal dependencies)                | request routing, 214                   |
| causal dependencies, 186-191                  | stateful and offline-capable, 170, 511 |
| capturing, 191, 342, 494, 514                 | clocks, 287-299                        |
| by total ordering, 493                        | atomic (caesium) clocks, 294, 295      |
| causal ordering, 339                          | confidence interval, 293-295           |
| in transactions, 262                          | for global snapshots, 294              |
| sending message to friends (example), 494     | logical (see logical clocks)           |

| skew, 291-294, 334                          | CompactProtocol encoding (Thrift), 119          |
|---------------------------------------------|-------------------------------------------------|
| slewing, 289                                | compare-and-set operations, 245, 327            |
| synchronization and accuracy, 289-291       | implementing locks, 370                         |
| synchronization using GPS, 287, 290, 294,   | implementing uniqueness constraints, 331        |
| 295                                         | implementing with total order broadcast,        |
| time-of-day versus monotonic clocks, 288    | 350                                             |
| timestamping events, 471                    | relation to consensus, 335, 350, 352, 374       |
| cloud computing, 146, 275                   | relation to transactions, 230                   |
| need for service discovery, 372             | compatibility, 112, 128                         |
| network glitches, 279                       | calling services, 136                           |
| shared resources, 284                       | properties of encoding formats, 139             |
| single-machine reliability, 8               | using databases, 129-131                        |
| Cloudera Impala (see Impala)                | using message-passing, 138                      |
| clustered indexes, 86                       | compensating transactions, 355, 461, 526        |
| CODASYL model, 36                           | complex event processing (CEP), 465             |
| (see also network model)                    | complexity                                      |
| code generation                             | distilling in theoretical models, 310           |
| with Avro, 127                              | hiding using abstraction, 27                    |
| with Thrift and Protocol Buffers, 118       | of software systems, managing, 20               |
| with WSDL, 133                              | composing data systems (see unbundling data‐    |
| collaborative editing                       | bases)                                          |
| multi-leader replication and, 170           | compute-intensive applications, 3, 275          |
| column families (Bigtable), 41, 99          | concatenated indexes, 87                        |
| column-oriented storage, 95-101             | in Cassandra, 204                               |
| column compression, 97                      | Concord (stream processor), 466                 |
| distinction between column families and, 99 | concurrency                                     |
| in batch processors, 428                    | actor programming model, 138, 468               |
| Parquet, 96, 131, 414                       | (see also message-passing)                      |
| sort order in, 99-100                       | bugs from weak transaction isolation, 233       |
| vectorized processing, 99, 428              | conflict resolution, 171, 174                   |
| writing to, 101                             | detecting concurrent writes, 184-191            |
| comma-separated values (see CSV)            | dual writes, problems with, 453                 |
| command query responsibility segregation    | happens-before relationship, 186                |
| (CQRS), 462                                 | in replicated systems, 161-191, 324-338         |
| commands (event sourcing), 459              | lost updates, 243                               |
| commits (transactions), 222                 | multi-version concurrency control               |
| atomic commit, 354-355                      | (MVCC), 239                                     |
| (see also atomicity; transactions)          | optimistic concurrency control, 261             |
| read committed isolation, 234               | ordering of operations, 326, 341                |
| three-phase commit (3PC), 359               | reducing, through event logs, 351, 462, 507     |
| two-phase commit (2PC), 355-359             | time and relativity, 187                        |
| commutative operations, 246                 | transaction isolation, 225                      |
| compaction                                  | write skew (transaction isolation), 246-251     |
| of changelogs, 456                          | conflict-free replicated datatypes (CRDTs), 174 |
| (see also log compaction)                   | conflicts                                       |
| for stream operator state, 479              | conflict detection, 172                         |
| of log-structured storage, 73               | causal dependencies, 186, 342                   |
| issues with, 84                             | in consensus algorithms, 368                    |
| size-tiered and leveled approaches, 79      | in leaderless replication, 184                  |
|                                             |                                                 |

| in log-based systems, 351, 521                   | crash recovery, 82                              |
|--------------------------------------------------|-------------------------------------------------|
| in nonlinearizable systems, 343                  | enforcing constraints (see constraints)         |
| in serializable snapshot isolation (SSI),        | eventual, 162, 322                              |
| 264                                              | (see also eventual consistency)                 |
| in two-phase commit, 357, 364                    | in ACID transactions, 224, 529                  |
| conflict resolution                              | in CAP theorem, 337                             |
| automatic conflict resolution, 174               | linearizability, 324-338                        |
| by aborting transactions, 261                    | meanings of, 224                                |
| by apologizing, 527                              | monotonic reads, 164-165                        |
| convergence, 172-174                             | of secondary indexes, 231, 241, 354, 491,       |
| in leaderless systems, 190                       | 500                                             |
| last write wins (LWW), 186, 292                  | ordering guarantees, 339-352                    |
| using atomic operations, 246                     | read-after-write, 162-164                       |
| using custom logic, 173                          | sequential, 351                                 |
| determining what is a conflict, 174, 522         | strong (see linearizability)                    |
| in multi-leader replication, 171-175             | timeliness and integrity, 524                   |
| avoiding conflicts, 172                          | using quorums, 181, 334                         |
| lost updates, 242-246                            | consistent hashing, 204                         |
| materializing, 251                               | consistent prefix reads, 165                    |
| relation to operation ordering, 339              | constraints (databases), 225, 248               |
| write skew (transaction isolation), 246-251      | asynchronously checked, 526                     |
| congestion (networks)                            | coordination avoidance, 527                     |
| avoidance, 282                                   | ensuring idempotence, 519                       |
| limiting accuracy of clocks, 293                 | in log-based systems, 521-524                   |
| queueing delays, 282                             | across multiple partitions, 522                 |
| consensus, 321, 364-375, 554                     | in two-phase commit, 355, 357                   |
| algorithms, 366-368                              | relation to consensus, 374, 521                 |
| preventing split brain, 367                      | relation to event ordering, 347                 |
| safety and liveness properties, 365              | requiring linearizability, 330                  |
|                                                  |                                                 |
| using linearizable operations, 351               | Consul (service discovery), 372                 |
| cost of, 369                                     | consumers (message streams), 137, 440           |
| distributed transactions, 352-375                | backpressure, 441                               |
| in practice, 360-364                             | consumer offsets in logs, 449                   |
| two-phase commit, 354-359                        | failures, 445, 449                              |
| XA transactions, 361-364                         | fan-out, 11, 445, 448                           |
| impossibility of, 353                            | load balancing, 444, 448                        |
| membership and coordination services,<br>370-373 | not keeping up with producers, 441, 450,<br>502 |
| relation to compare-and-set, 335, 350, 352,      | context switches, 14, 297                       |
| 374                                              | convergence (conflict resolution), 172-174, 322 |
| relation to replication, 155, 349                | coordination                                    |
| relation to uniqueness constraints, 521          | avoidance, 527                                  |
| consistency, 224, 524                            | cross-datacenter, 168, 493                      |
| across different databases, 157, 452, 462, 492   | cross-partition ordering, 256, 294, 348, 523    |
| causal, 339-348, 493                             | services, 330, 370-373                          |
| consistent prefix reads, 165-167                 | coordinator (in 2PC), 356                       |
| consistent snapshots, 156, 237-242, 294,         | failure, 358                                    |
| 455, 500                                         | in XA transactions, 361-364                     |
| (see also snapshots)                             | recovery, 363                                   |
|                                                  |                                                 |

| copy-on-write (B-trees), 82, 242               | Crunch (batch processing), 419, 427        |
|------------------------------------------------|--------------------------------------------|
| CORBA (Common Object Request Broker            | hash joins, 409                            |
| Architecture), 134                             | sharded joins, 408                         |
| correctness, 6                                 | workflows, 403                             |
| auditability, 528-533                          | cryptography                               |
| Byzantine fault tolerance, 305, 532            | defense against attackers, 306             |
| dealing with partial failures, 274             | end-to-end encryption and authentication,  |
| in log-based systems, 521-524                  | 519, 543                                   |
| of algorithm within system model, 308          | proving integrity of data, 532             |
| of compensating transactions, 355              | CSS (Cascading Style Sheets), 44           |
| of consensus, 368                              | CSV (comma-separated values), 70, 114, 396 |
| of derived data, 497, 531                      | Curator (ZooKeeper recipes), 330, 371      |
| of immutable data, 461                         | curl (Unix tool), 135, 397                 |
| of personal data, 535, 540                     | cursor stability, 243                      |
| of time, 176, 289-295                          | Cypher (query language), 52                |
| of transactions, 225, 515, 529                 | comparison to SPARQL, 59                   |
| timeliness and integrity, 524-528              |                                            |
| corruption of data                             | D                                          |
| detecting, 519, 530-533                        |                                            |
| due to pathological memory access, 529         | data corruption (see corruption of data)   |
| due to radiation, 305                          | data cubes, 102                            |
| due to split brain, 158, 302                   | data formats (see encoding)                |
| due to weak transaction isolation, 233         | data integration, 490-498, 543             |
| formalization in consensus, 366                | batch and stream processing, 494-498       |
| integrity as absence of, 524                   | lambda architecture, 497                   |
| network packets, 306                           | maintaining derived state, 495             |
| on disks, 227                                  | reprocessing data, 496                     |
| preventing using write-ahead logs, 82          | unifying, 498                              |
| recovering from, 414, 460                      | by unbundling databases, 499-515           |
| Couchbase (database)                           | comparison to federated databases, 501     |
| durability, 89                                 | combining tools by deriving data, 490-494  |
| hash partitioning, 203-204, 211                | derived data versus distributed transac‐   |
| rebalancing, 213                               | tions, 492                                 |
| request routing, 216                           | limits of total ordering, 493              |
| CouchDB (database)                             | ordering events to capture causality, 493  |
|                                                | reasoning about dataflows, 491             |
| B-tree storage, 242                            | need for, 385                              |
| change feed, 456                               | data lakes, 415                            |
| document data model, 31                        | data locality (see locality)               |
| join support, 34                               | data models, 27-64                         |
| MapReduce support, 46, 400                     | graph-like models, 49-63                   |
| replication, 170, 173                          | Datalog language, 60-63                    |
| covering indexes, 86                           | property graphs, 50                        |
| CPUs                                           | RDF and triple-stores, 55-59               |
| cache coherence and memory barriers, 338       | query languages, 42-48                     |
| caching and pipelining, 99, 428                | relational model versus document model,    |
| increasing parallelism, 43                     | 28-42                                      |
| CRDTs (see conflict-free replicated datatypes) | data protection regulations, 542           |
| CREATE INDEX statement (SQL), 85, 500          | data systems, 3                            |
| credit rating agencies, 535                    | about, 4                                   |
|                                                |                                            |

| concerns when designing, 5                          | observing derived state, 509-515                  |
|-----------------------------------------------------|---------------------------------------------------|
| future of, 489-544                                  | datacenters                                       |
| correctness, constraints, and integrity,<br>515-533 | geographically distributed, 145, 164, 278,<br>493 |
| data integration, 490-498                           | multi-tenancy and shared resources, 284           |
| unbundling databases, 499-515                       | network architecture, 276                         |
| heterogeneous, keeping in sync, 452                 | network faults, 279                               |
| maintainability, 18-22                              | replication across multiple, 169                  |
| possible faults in, 221                             | leaderless replication, 184                       |
| reliability, 6-10                                   | multi-leader replication, 168, 335                |
| hardware faults, 7                                  | dataflow, 128-139, 504-509                        |
| human errors, 9                                     | correctness of dataflow systems, 525              |
| importance of, 10                                   | differential, 504                                 |
| software errors, 8                                  | message-passing, 136-139                          |
|                                                     |                                                   |
| scalability, 10-18                                  | reasoning about, 491                              |
| unreliable clocks, 287-299                          | through databases, 129                            |
| data warehousing, 91-95, 554                        | through services, 131-136                         |
| comparison to data lakes, 415                       | dataflow engines, 421-423                         |
| ETL (extract-transform-load), 92, 416, 452          | comparison to stream processing, 464              |
| keeping data systems in sync, 452                   | directed acyclic graphs (DAG), 424                |
| schema design, 93                                   | partitioning, approach to, 429                    |
| slowly changing dimension (SCD), 476                | support for declarative queries, 427              |
| data-intensive applications, 3                      | Datalog (query language), 60-63                   |
| database triggers (see triggers)                    | datatypes                                         |
| database-internal distributed transactions, 360,    | binary strings in XML and JSON, 114               |
| 364, 477                                            | conflict-free, 174                                |
| databases                                           | in Avro encodings, 122                            |
| archival storage, 131                               | in Thrift and Protocol Buffers, 121               |
| comparison of message brokers to, 443               | numbers in XML and JSON, 114                      |
| dataflow through, 129                               | Datomic (database)                                |
| end-to-end argument for, 519-520                    | B-tree storage, 242                               |
| checking integrity, 531                             | data model, 50, 57                                |
| inside-out, 504                                     | Datalog query language, 60                        |
| (see also unbundling databases)                     | excision (deleting data), 463                     |
| output from batch workflows, 412                    | languages for transactions, 255                   |
| relation to event streams, 451-464                  | serial execution of transactions, 253             |
| (see also changelogs)                               | deadlocks                                         |
| API support for change streams, 456,                | detection, in two-phase commit (2PC), 364         |
| 506                                                 | in two-phase locking (2PL), 258                   |
| change data capture, 454-457                        | Debezium (change data capture), 455               |
| event sourcing, 457-459                             | declarative languages, 42, 554                    |
| keeping systems in sync, 452-453                    | Bloom, 504                                        |
| philosophy of immutable events,                     | CSS and XSL, 44                                   |
| 459-464                                             | Cypher, 52                                        |
| unbundling, 499-515                                 | Datalog, 60                                       |
| composing data storage technologies,                | for batch processing, 427                         |
| 499-504                                             | recursive SQL queries, 53                         |
| designing applications around dataflow,             | relational algebra and SQL, 42                    |
| 504-509                                             | SPARQL, 59                                        |
|                                                     |                                                   |

| delays                                         | issues with failover, 157                       |
|------------------------------------------------|-------------------------------------------------|
| bounded network delays, 285                    | limitations of distributed transactions, 363    |
| bounded process pauses, 298                    | multi-datacenter, 169, 335                      |
| unbounded network delays, 282                  | network problems, 277-286                       |
| unbounded process pauses, 296                  | quorums, relying on, 301                        |
| deleting data, 463                             | reasons for using, 145, 151                     |
| denormalization (data representation), 34, 554 | synchronized clocks, relying on, 291-295        |
| costs, 39                                      | system models, 306-310                          |
| in derived data systems, 386                   | use of clocks and time, 287                     |
| materialized views, 101                        | distributed transactions (see transactions)     |
| updating derived data, 228, 231, 490           | Django (web framework), 232                     |
| versus normalization, 462                      | DNS (Domain Name System), 216, 372              |
| derived data, 386, 439, 554                    | Docker (container manager), 506                 |
| from change data capture, 454                  | document data model, 30-42                      |
| in event sourcing, 458-458                     | comparison to relational model, 38-42           |
| maintaining derived state through logs,        | document references, 38, 403                    |
| 452-457, 459-463                               | document-oriented databases, 31                 |
| observing, by subscribing to streams, 512      | many-to-many relationships and joins, 36        |
| outputs of batch and stream processing, 495    | multi-object transactions, need for, 231        |
| through application code, 505                  | versus relational model                         |
| versus distributed transactions, 492           | convergence of models, 41                       |
|                                                |                                                 |
| deterministic operations, 255, 274, 554        | data locality, 41                               |
| accidental nondeterminism, 423                 | document-partitioned indexes, 206, 217, 411     |
| and fault tolerance, 423, 426                  | domain-driven design (DDD), 457                 |
| and idempotence, 478, 492                      | DRBD (Distributed Replicated Block Device),     |
| computing derived data, 495, 526, 531          | 153                                             |
| in state machine replication, 349, 452, 458    | drift (clocks), 289                             |
| joins, 476                                     | Drill (query engine), 93                        |
| DevOps, 394                                    | Druid (database), 461                           |
| differential dataflow, 504                     | Dryad (dataflow engine), 421                    |
| dimension tables, 94                           | dual writes, problems with, 452, 507            |
| dimensional modeling (see star schemas)        | duplicates, suppression of, 517                 |
| directed acyclic graphs (DAGs), 424            | (see also idempotence)                          |
| dirty reads (transaction isolation), 234       | using a unique ID, 518, 522                     |
| dirty writes (transaction isolation), 235      | durability (transactions), 226, 554             |
| discrimination, 534                            | duration (time), 287                            |
| disks (see hard disks)                         | measurement with monotonic clocks, 288          |
| distributed actor frameworks, 138              | dynamic partitioning, 212                       |
| distributed filesystems, 398-399               | dynamically typed languages                     |
| decoupling from query engines, 417             | analogy to schema-on-read, 40                   |
| indiscriminately dumping data into, 415        | code generation and, 127                        |
| use by MapReduce, 402                          | Dynamo-style databases (see leaderless replica‐ |
| distributed systems, 273-312, 554              | tion)                                           |
| Byzantine faults, 304-306                      |                                                 |
| cloud versus supercomputing, 275               | E                                               |
| detecting network faults, 280                  |                                                 |
| faults and partial failures, 274-277           | edges (in graphs), 49, 403                      |
| formalization of consensus, 365                | property graph model, 50                        |
|                                                | edit distance (full-text search), 88            |
| impossibility results, 338, 353                | effectively-once semantics, 476, 516            |

| (see also exactly-once semantics)      | Etherpad (collaborative editor), 170            |
|----------------------------------------|-------------------------------------------------|
| preservation of integrity, 525         | ethics, 533-543                                 |
| elastic systems, 17                    | code of ethics and professional practice, 533   |
| Elasticsearch (search server)          | legislation and self-regulation, 542            |
| document-partitioned indexes, 207      | predictive analytics, 533-536                   |
| partition rebalancing, 211             | amplifying bias, 534                            |
| percolator (stream search), 467        | feedback loops, 536                             |
| usage example, 4                       | privacy and tracking, 536-543                   |
| use of Lucene, 79                      | consent and freedom of choice, 538              |
| ElephantDB (database), 413             | data as assets and power, 540                   |
| Elm (programming language), 504, 512   | meaning of privacy, 539                         |
| encodings (data formats), 111-128      | surveillance, 537                               |
| Avro, 122-127                          | respect, dignity, and agency, 543, 544          |
| binary variants of JSON and XML, 115   | unintended consequences, 533, 536               |
| compatibility, 112                     | ETL (extract-transform-load), 92, 405, 452, 554 |
| calling services, 136                  | use of Hadoop for, 416                          |
| using databases, 129-131               | event sourcing, 457-459                         |
| using message-passing, 138             | commands and events, 459                        |
| defined, 113                           | comparison to change data capture, 457          |
| JSON, XML, and CSV, 114                | comparison to lambda architecture, 497          |
| language-specific formats, 113         | deriving current state from event log, 458      |
| merits of schemas, 127                 | immutability and auditability, 459, 531         |
| representations of data, 112           | large, reliable data systems, 519, 526          |
| Thrift and Protocol Buffers, 117-121   | Event Store (database), 458                     |
| end-to-end argument, 277, 519-520      | event streams (see streams)                     |
| checking integrity, 531                | events, 440                                     |
| publish/subscribe streams, 512         | deciding on total order of, 493                 |
| enrichment (stream), 473               | deriving views from event log, 461              |
| Enterprise JavaBeans (EJB), 134        | difference to commands, 459                     |
| entities (see vertices)                | event time versus processing time, 469, 477,    |
| epoch (consensus algorithms), 368      | 498                                             |
| epoch (Unix timestamps), 288           | immutable, advantages of, 460, 531              |
| equi-joins, 403                        | ordering to capture causality, 493              |
| erasure coding (error correction), 398 | reads as, 513                                   |
| Erlang OTP (actor framework), 139      | stragglers, 470, 498                            |
| error handling                         | timestamp of, in stream processing, 471         |
| for network faults, 280                | EventSource (browser API), 512                  |
| in transactions, 231                   | eventual consistency, 152, 162, 308, 322        |
| error-correcting codes, 277, 398       | (see also conflicts)                            |
| Esper (CEP engine), 466                | and perpetual inconsistency, 525                |
| etcd (coordination service), 370-373   | evolvability, 21, 111                           |
| linearizable operations, 333           | calling services, 136                           |
| locks and leader election, 330         | graph-structured data, 52                       |
| quorum reads, 351                      | of databases, 40, 129-131, 461, 497             |
| service discovery, 372                 | of message-passing, 138                         |
| use of Raft algorithm, 349, 353        | reprocessing data, 496, 498                     |
| Ethereum (blockchain), 532             | schema evolution in Avro, 123                   |
| Ethernet (networks), 276, 278, 285     | schema evolution in Thrift and Protocol         |
| packet checksums, 306, 519             | Buffers, 120                                    |

| schema-on-read, 39, 111, 128                  | of distributed transactions, 362-364              |
|-----------------------------------------------|---------------------------------------------------|
| exactly-once semantics, 360, 476, 516         | transaction atomicity, 223, 354-361               |
| parity with batch processors, 498             | faults, 6                                         |
| preservation of integrity, 525                | Byzantine faults, 304-306                         |
| exclusive mode (locks), 258                   | failures versus, 7                                |
| eXtended Architecture transactions (see XA    | handled by transactions, 221                      |
| transactions)                                 | handling in supercomputers and cloud              |
| extract-transform-load (see ETL)              | computing, 275                                    |
|                                               | hardware, 7                                       |
| F                                             | in batch processing versus distributed data‐      |
| Facebook                                      | bases, 417                                        |
| Presto (query engine), 93                     | in distributed systems, 274-277                   |
| React, Flux, and Redux (user interface libra‐ | introducing deliberately, 7, 280                  |
| ries), 512                                    | network faults, 279-281                           |
|                                               | asymmetric faults, 300                            |
| social graphs, 49                             | detecting, 280                                    |
| Wormhole (change data capture), 455           | tolerance of, in multi-leader replication,        |
| fact tables, 93                               | 169                                               |
| failover, 157, 554                            | software errors, 8                                |
| (see also leader-based replication)           | tolerating (see fault tolerance)                  |
| in leaderless replication, absence of, 178    | federated databases, 501                          |
| leader election, 301, 348, 352                | fence (CPU instruction), 338                      |
| potential problems, 157                       | fencing (preventing split brain), 158, 302-304    |
| failures                                      | generating fencing tokens, 349, 370               |
| amplification by distributed transactions,    | properties of fencing tokens, 308                 |
| 364, 495                                      | stream processors writing to databases, 478,      |
| failure detection, 280                        | 517                                               |
| automatic rebalancing causing cascading       | Fibre Channel (networks), 398                     |
| failures, 214                                 | field tags (Thrift and Protocol Buffers), 119-121 |
| perfect failure detectors, 359                | file descriptors (Unix), 395                      |
| timeouts and unbounded delays, 282,           | financial data, 460                               |
| 284                                           | Firebase (database), 456                          |
| using ZooKeeper, 371                          | Flink (processing framework), 421-423             |
| faults versus, 7                              | dataflow APIs, 427                                |
| partial failures in distributed systems,      | fault tolerance, 422, 477, 479                    |
| 275-277, 310                                  | Gelly API (graph processing), 425                 |
| fan-out (messaging systems), 11, 445          | integration of batch and stream processing,       |
| fault tolerance, 6-10, 555                    | 495, 498                                          |
| abstractions for, 321                         | machine learning, 428                             |
| formalization in consensus, 365-369           | query optimizer, 427                              |
| use of replication, 367                       | stream processing, 466                            |
| human fault tolerance, 414                    | flow control, 282, 441, 555                       |
| in batch processing, 406, 414, 422, 425       | FLP result (on consensus), 353                    |
| in log-based systems, 520, 524-526            | FlumeJava (dataflow library), 403, 427            |
| in stream processing, 476-479                 | followers, 152, 555                               |
| atomic commit, 477                            | (see also leader-based replication)               |
| idempotence, 478                              | foreign keys, 38, 403                             |
| maintaining derived state, 495                | forward compatibility, 112                        |
| microbatching and checkpointing, 477          | forward decay (algorithm), 16                     |
| rebuilding state after a failure, 478         |                                                   |

| Fossil (version control system), 463          | (see also MapReduce)                          |
|-----------------------------------------------|-----------------------------------------------|
| shunning (deleting data), 463                 | building search indexes, 411                  |
| FoundationDB (database)                       | task preemption, 418                          |
| serializable transactions, 261, 265, 364      | Pregel (graph processing), 425                |
| fractal trees, 83                             | Spanner (see Spanner)                         |
| full table scans, 403                         | TrueTime (clock API), 294                     |
| full-text search, 555                         | gossip protocol, 216                          |
| and fuzzy indexes, 88                         | government use of data, 541                   |
| building search indexes, 411                  | GPS (Global Positioning System)               |
| Lucene storage engine, 79                     | use for clock synchronization, 287, 290, 294, |
| functional reactive programming (FRP), 504    | 295                                           |
| functional requirements, 22                   | GraphChi (graph processing), 426              |
| futures (asynchronous operations), 135        | graphs, 555                                   |
| fuzzy search (see similarity search)          | as data models, 49-63                         |
|                                               | example of graph-structured data, 49          |
| G                                             | property graphs, 50                           |
| garbage collection                            | RDF and triple-stores, 55-59                  |
| immutability and, 463                         | versus the network model, 60                  |
| process pauses for, 14, 296-299, 301          | processing and analysis, 424-426              |
| (see also process pauses)                     | fault tolerance, 425                          |
| genome analysis, 63, 429                      | Pregel processing model, 425                  |
| geographically distributed datacenters, 145,  | query languages                               |
| 164, 278, 493                                 | Cypher, 52                                    |
| geospatial indexes, 87                        | Datalog, 60-63                                |
| Giraph (graph processing), 425                | recursive SQL queries, 53                     |
| Git (version control system), 174, 342, 463   | SPARQL, 59-59                                 |
| GitHub, postmortems, 157, 158, 309            | Gremlin (graph query language), 50            |
| global indexes (see term-partitioned indexes) | grep (Unix tool), 392                         |
| GlusterFS (distributed filesystem), 398       | GROUP BY clause (SQL), 406                    |
| GNU Coreutils (Linux), 394                    | grouping records in MapReduce, 406            |
| GoldenGate (change data capture), 161, 170,   | handling skew, 407                            |
| 455                                           |                                               |
| (see also Oracle)                             | H                                             |
| Google                                        | Hadoop (data infrastructure)                  |
| Bigtable (database)                           | comparison to distributed databases, 390      |
| data model (see Bigtable data model)          | comparison to MPP databases, 414-418          |
| partitioning scheme, 199, 202                 | comparison to Unix, 413-414, 499              |
| storage layout, 78                            | diverse processing models in ecosystem, 417   |
| Chubby (lock service), 370                    | HDFS distributed filesystem (see HDFS)        |
| Cloud Dataflow (stream processor), 466,       | higher-level tools, 403                       |
| 477, 498                                      | join algorithms, 403-410                      |
| (see also Beam)                               | (see also MapReduce)                          |
| Cloud Pub/Sub (messaging), 444, 448           | MapReduce (see MapReduce)                     |
| Docs (collaborative editor), 170              | YARN (see YARN)                               |
| Dremel (query engine), 93, 96                 | happens-before relationship, 340              |
| FlumeJava (dataflow library), 403, 427        | capturing, 187                                |
| GFS (distributed file system), 398            | concurrency and, 186                          |
| gRPC (RPC framework), 135                     | hard disks                                    |
| MapReduce (batch processing), 390             | access patterns, 84                           |

| detecting corruption, 519, 530               | high-performance computing (HPC), 275       |
|----------------------------------------------|---------------------------------------------|
| faults in, 7, 227                            | hinted handoff, 183                         |
| sequential write throughput, 75, 450         | histograms, 16                              |
| hardware faults, 7                           | Hive (query engine), 419, 427               |
| hash indexes, 72-75                          | for data warehouses, 93                     |
| broadcast hash joins, 409                    | HCatalog and metastore, 410                 |
| partitioned hash joins, 409                  | map-side joins, 409                         |
| hash partitioning, 203-205, 217              | query optimizer, 427                        |
| consistent hashing, 204                      | skewed joins, 408                           |
| problems with hash mod N, 210                | workflows, 403                              |
| range queries, 204                           | Hollerith machines, 390                     |
| suitable hash functions, 203                 | hopping windows (stream processing), 472    |
| with fixed number of partitions, 210         | (see also windows)                          |
| HAWQ (database), 428                         | horizontal scaling (see scaling out)        |
| HBase (database)                             | HornetQ (messaging), 137, 444               |
| bug due to lack of fencing, 302              | distributed transaction support, 361        |
| bulk loading, 413                            | hot spots, 201                              |
| column-family data model, 41, 99             | due to celebrities, 205                     |
| dynamic partitioning, 212                    | for time-series data, 203                   |
| key-range partitioning, 202                  | in batch processing, 407                    |
| log-structured storage, 78                   | relieving, 205                              |
| request routing, 216                         | hot standbys (see leader-based replication) |
| size-tiered compaction, 79                   | HTTP, use in APIs (see services)            |
| use of HDFS, 417                             | human errors, 9, 279, 414                   |
| use of ZooKeeper, 370                        | HyperDex (database), 88                     |
| HDFS (Hadoop Distributed File System),       | HyperLogLog (algorithm), 466                |
| 398-399                                      |                                             |
| (see also distributed filesystems)           | I                                           |
| checking data integrity, 530                 | I/O operations, waiting for, 297            |
| decoupling from query engines, 417           | IBM                                         |
| indiscriminately dumping data into, 415      | DB2 (database)                              |
| metadata about datasets, 410                 | distributed transaction support, 361        |
| NameNode, 398                                |                                             |
| use by Flink, 479                            | recursive query support, 54                 |
| use by HBase, 212                            | serializable isolation, 242, 257            |
| use by MapReduce, 402                        | XML and JSON support, 30, 42                |
| HdrHistogram (numerical library), 16         | electromechanical card-sorting machines,    |
| head (Unix tool), 392                        | 390                                         |
| head vertex (property graphs), 51            | IMS (database), 36                          |
| head-of-line blocking, 15                    | imperative query APIs, 46                   |
| heap files (databases), 86                   | InfoSphere Streams (CEP engine), 466        |
| Helix (cluster manager), 216                 | MQ (messaging), 444                         |
| heterogeneous distributed transactions, 360, | distributed transaction support, 361        |
| 364                                          | System R (database), 222                    |
| heuristic decisions (in 2PC), 363            | WebSphere (messaging), 137                  |
| Hibernate (object-relational mapper), 30     | idempotence, 134, 478, 555                  |
| hierarchical model, 36                       | by giving operations unique IDs, 518, 522   |
| high availability (see fault tolerance)      | idempotent operations, 517                  |
| high-frequency trading, 290, 299             | immutability                                |
|                                              | advantages of, 460, 531                     |

| deriving state from event log, 459-464      | B-trees, 79-83                                  |
|---------------------------------------------|-------------------------------------------------|
| for crash recovery, 75                      | building in batch processes, 411                |
| in B-trees, 82, 242                         | clustered, 86                                   |
| in event sourcing, 457                      | comparison of B-trees and LSM-trees, 83-85      |
| inputs to Unix commands, 397                | concatenated, 87                                |
| limitations of, 463                         | covering (with included columns), 86            |
| Impala (query engine)                       | creating, 500                                   |
| for data warehouses, 93                     | full-text search, 88                            |
| hash joins, 409                             | geospatial, 87                                  |
| native code generation, 428                 | hash, 72-75                                     |
| use of HDFS, 417                            | index-range locking, 260                        |
| impedance mismatch, 29                      | multi-column, 87                                |
| imperative languages, 42                    | partitioning and secondary indexes,             |
| setting element styles (example), 45        | 206-209, 217                                    |
| in doubt (transaction status), 358          | secondary, 85                                   |
| holding locks, 362                          | (see also secondary indexes)                    |
| orphaned transactions, 363                  | problems with dual writes, 452, 491             |
| in-memory databases, 88                     | SSTables and LSM-trees, 76-79                   |
| durability, 227                             | updating when data changes, 452, 467            |
| serial transaction execution, 253           | Industrial Revolution, 541                      |
| incidents                                   | InfiniBand (networks), 285                      |
| cascading failures, 9                       | InfiniteGraph (database), 50                    |
| crashes due to leap seconds, 290            | InnoDB (storage engine)                         |
| data corruption and financial losses due to | clustered index on primary key, 86              |
| concurrency bugs, 233                       | not preventing lost updates, 245                |
| data corruption on hard disks, 227          | preventing write skew, 248, 257                 |
| data loss due to last-write-wins, 173, 292  | serializable isolation, 257                     |
|                                             |                                                 |
| data on disks unreadable, 309               | snapshot isolation support, 239                 |
| deleted items reappearing, 174              | inside-out databases, 504                       |
| disclosure of sensitive data due to primary | (see also unbundling databases)                 |
| key reuse, 157                              | integrating different data systems (see data    |
| errors in transaction serializability, 529  | integration)                                    |
| gigabit network interface with 1 Kb/s       | integrity, 524                                  |
| throughput, 311                             | coordination-avoiding data systems, 528         |
| network faults, 279                         | correctness of dataflow systems, 525            |
| network interface dropping only inbound     | in consensus formalization, 365                 |
| packets, 279                                | integrity checks, 530                           |
| network partitions and whole-datacenter     | (see also auditing)                             |
| failures, 275                               | end-to-end, 519, 531                            |
| poor handling of network faults, 280        | use of snapshot isolation, 238                  |
| sending message to ex-partner, 494          | maintaining despite software bugs, 529          |
| sharks biting undersea cables, 279          | Interface Definition Language (IDL), 117, 122   |
| split brain due to 1-minute packet delay,   | intermediate state, materialization of, 420-423 |
| 158, 279                                    | internet services, systems for implementing,    |
| vibrations in server rack, 14               | 275                                             |
| violation of uniqueness constraint, 529     | invariants, 225                                 |
| indexes, 71, 555                            | (see also constraints)                          |
| and snapshot isolation, 241                 | inversion of control, 396                       |
| as derived data, 386, 499-504               | IP (Internet Protocol)                          |
|                                             |                                                 |

| unreliability of, 277<br>MapReduce reduce-side joins, 403-408<br>ISDN (Integrated Services Digital Network),<br>handling skew, 407<br>284<br>sort-merge joins, 405<br>isolation (in transactions), 225, 228, 555<br>parallel execution of, 415<br>correctness and, 515<br>secondary indexes and, 85<br>for single-object writes, 230<br>stream joins, 472-476<br>serializability, 251-266<br>stream-stream join, 473<br>actual serial execution, 252-256<br>stream-table join, 473<br>serializable snapshot isolation (SSI),<br>table-table join, 474<br>261-266<br>time-dependence of, 475<br>two-phase locking (2PL), 257-261<br>support in document databases, 42<br>violating, 228<br>JOTM (transaction coordinator), 356<br>weak isolation levels, 233-251<br>JSON<br>preventing lost updates, 242-246<br>Avro schema representation, 122<br>read committed, 234-237<br>binary variants, 115<br>snapshot isolation, 237-242<br>for application data, issues with, 114<br>iterative processing, 424-426<br>in relational databases, 30, 42<br>representing a résumé (example), 31<br>J<br>Juttle (query language), 504<br>Java Database Connectivity (JDBC)<br>K<br>distributed transaction support, 361<br>network drivers, 128<br>k-nearest neighbors, 429<br>Java Enterprise Edition (EE), 134, 356, 361<br>Kafka (messaging), 137, 448<br>Java Message Service (JMS), 444<br>(see also messaging systems)<br>461<br>comparison to log-based messaging, 448,<br>451<br>fault tolerance, 479<br>distributed transaction support, 361<br>leader-based replication, 153<br>message ordering, 446<br>log compaction, 456, 467<br>Java Transaction API (JTA), 355, 361<br>message offsets, 447, 478<br>Java Virtual Machine (JVM)<br>request routing, 216<br>bytecode generation, 428<br>transaction support, 477<br>garbage collection pauses, 296<br>usage example, 4<br>process reuse in batch processors, 422<br>Ketama (partitioning library), 213<br>JavaScript<br>key-value stores, 70 |                           |                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|--------------------------------------------|
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           | Kafka Connect (database integration), 457, |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           | Kafka Streams (stream processor), 466, 467 |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | in MapReduce querying, 46 | as batch process output, 412               |
| setting element styles (example), 45<br>hash indexes, 72-75                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                           |                                            |
| use in advanced queries, 48<br>in-memory, 89                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                           |                                            |
| Jena (RDF framework), 57<br>partitioning, 201-205                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                           |                                            |
| Jepsen (fault tolerance testing), 515<br>by hash of key, 203, 217                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                           |                                            |
| jitter (network delay), 284<br>by key range, 202, 217                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                           |                                            |
| joins, 555<br>dynamic partitioning, 212                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                           |                                            |
| by index lookup, 403<br>skew and hot spots, 205                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
| expressing as relational operators, 427<br>Kryo (Java), 113                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                           |                                            |
| in relational and document databases, 34<br>Kubernetes (cluster manager), 418, 506                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                           |                                            |
| MapReduce map-side joins, 408-410                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                           |                                            |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                           |                                            |
| L<br>broadcast hash joins, 409                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                           |                                            |
| merge joins, 410<br>lambda architecture, 497                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                           |                                            |
| partitioned hash joins, 409<br>Lamport timestamps, 345                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                           |                                            |

| Large Hadron Collider (LHC), 64           | need for fencing, 302                       |
|-------------------------------------------|---------------------------------------------|
| last write wins (LWW), 173, 334           | ledgers, 460                                |
| discarding concurrent writes, 186         | distributed ledger technologies, 532        |
| problems with, 292                        | legacy systems, maintenance of, 18          |
| prone to lost updates, 246                | less (Unix tool), 397                       |
| late binding, 396                         | LevelDB (storage engine), 78                |
| latency                                   | leveled compaction, 79                      |
| instability under two-phase locking, 259  | Levenshtein automata, 88                    |
| network latency and resource utilization, | limping (partial failure), 311              |
| 286                                       | linearizability, 324-338, 555               |
| response time versus, 14                  | cost of, 335-338                            |
| tail latency, 15, 207                     | CAP theorem, 336                            |
| leader-based replication, 152-161         | memory on multi-core CPUs, 338              |
| (see also replication)                    | definition, 325-329                         |
| failover, 157, 301                        | implementing with total order broadcast,    |
| handling node outages, 156                | 350                                         |
| implementation of replication logs        | in ZooKeeper, 370                           |
| change data capture, 454-457              | of derived data systems, 492, 524           |
| (see also changelogs)                     | avoiding coordination, 527                  |
| statement-based, 158                      | of different replication methods, 332-335   |
| trigger-based replication, 161            | using quorums, 334                          |
| write-ahead log (WAL) shipping, 159       | relying on, 330-332                         |
| linearizability of operations, 333        | constraints and uniqueness, 330             |
| locking and leader election, 330          | cross-channel timing dependencies, 331      |
| log sequence number, 156, 449             | locking and leader election, 330            |
| read-scaling architecture, 161            | stronger than causal consistency, 342       |
| relation to consensus, 367                | using to implement total order broadcast,   |
| setting up new followers, 155             | 351                                         |
| synchronous versus asynchronous, 153-155  | versus serializability, 329                 |
| leaderless replication, 177-191           | LinkedIn                                    |
| (see also replication)                    | Azkaban (workflow scheduler), 402           |
| detecting concurrent writes, 184-191      | Databus (change data capture), 161, 455     |
| capturing happens-before relationship,    | Espresso (database), 31, 126, 130, 153, 216 |
| 187                                       | Helix (cluster manager) (see Helix)         |
| happens-before relationship and concur‐   | profile (example), 30                       |
| rency, 186                                | reference to company entity (example), 34   |
| last write wins, 186                      | Rest.li (RPC framework), 135                |
| merging concurrently written values,      | Voldemort (database) (see Voldemort)        |
| 190                                       | Linux, leap second bug, 8, 290              |
| version vectors, 191                      | liveness properties, 308                    |
| multi-datacenter, 184                     | LMDB (storage engine), 82, 242              |
| quorums, 179-182                          | load                                        |
| consistency limitations, 181-183, 334     | approaches to coping with, 17               |
| sloppy quorums and hinted handoff, 183    | describing, 11                              |
| read repair and anti-entropy, 178         | load testing, 16                            |
| leap seconds, 8, 290                      | load balancing (messaging), 444             |
| in time-of-day clocks, 288                | local indexes (see document-partitioned     |
| leases, 295                               | indexes)                                    |
|                                           |                                             |
| implementation with ZooKeeper, 370        | locality (data access), 32, 41, 555         |

| in batch processing, 400, 405, 421           | replication, 152, 158-161                    |
|----------------------------------------------|----------------------------------------------|
| in stateful clients, 170, 511                | change data capture, 454-457                 |
| in stream processing, 474, 478, 508, 522     | (see also changelogs)                        |
| location transparency, 134                   | coordination with snapshot, 156              |
| in the actor model, 138                      | logical (row-based) replication, 160         |
| locks, 556                                   | statement-based replication, 158             |
| deadlock, 258                                | trigger-based replication, 161               |
| distributed locking, 301-304, 330            | write-ahead log (WAL) shipping, 159          |
| fencing tokens, 303                          | scalability limits, 493                      |
| implementation with ZooKeeper, 370           | loose coupling, 396, 419, 502                |
| relation to consensus, 374                   | lost updates (see updates)                   |
| for transaction isolation                    | LSM-trees (indexes), 78-79                   |
| in snapshot isolation, 239                   | comparison to B-trees, 83-85                 |
| in two-phase locking (2PL), 257-261          | Lucene (storage engine), 79                  |
| making operations atomic, 243                | building indexes in batch processes, 411     |
| performance, 258                             | similarity search, 88                        |
| preventing dirty writes, 236                 | Luigi (workflow scheduler), 402              |
| preventing phantoms with index-range         | LWW (see last write wins)                    |
| locks, 260, 265                              |                                              |
| read locks (shared mode), 236, 258           | M                                            |
| shared mode and exclusive mode, 258          |                                              |
| in two-phase commit (2PC)                    | machine learning                             |
| deadlock detection, 364                      | ethical considerations, 534                  |
| in-doubt transactions holding locks, 362     | (see also ethics)                            |
| materializing conflicts with, 251            | iterative processing, 424                    |
| preventing lost updates by explicit locking, | models derived from training data, 505       |
| 244                                          | statistical and numerical algorithms, 428    |
| log sequence number, 156, 449                | MADlib (machine learning toolkit), 428       |
| logic programming languages, 504             | magic scaling sauce, 18                      |
| logical clocks, 293, 343, 494                | Mahout (machine learning toolkit), 428       |
| for read-after-write consistency, 164        | maintainability, 18-22, 489                  |
| logical logs, 160                            | defined, 23                                  |
| logs (data structure), 71, 556               | design principles for software systems, 19   |
| advantages of immutability, 460              | evolvability (see evolvability)              |
| compaction, 73, 79, 456, 460                 | operability, 19                              |
| for stream operator state, 479               | simplicity and managing complexity, 20       |
| creating using total order broadcast, 349    | many-to-many relationships                   |
| implementing uniqueness constraints, 522     | in document model versus relational model,   |
| log-based messaging, 446-451                 | 39                                           |
| comparison to traditional messaging,         | modeling as graphs, 49                       |
| 448, 451                                     | many-to-one and many-to-many relationships,  |
| consumer offsets, 449                        | 33-36                                        |
| disk space usage, 450                        | many-to-one relationships, 34                |
| replaying old messages, 451, 496, 498        | MapReduce (batch processing), 390, 399-400   |
| slow consumers, 450                          | accessing external services within job, 404, |
| using logs for message storage, 447          | 412                                          |
| log-structured storage, 71-79                | comparison to distributed databases          |
| log-structured merge tree (see LSM           | designing for frequent faults, 417           |
|                                              | diversity of processing models, 416          |
| trees)                                       | diversity of storage, 415                    |

| comparison to stream processing, 464              | meeting room booking (example), 249, 259, |
|---------------------------------------------------|-------------------------------------------|
| comparison to Unix, 413-414                       | 521                                       |
| disadvantages and limitations of, 419             | membership services, 372                  |
| fault tolerance, 406, 414, 422                    | Memcached (caching server), 4, 89         |
| higher-level tools, 403, 426                      | memory                                    |
| implementation in Hadoop, 400-403                 | in-memory databases, 88                   |
| the shuffle, 402                                  | durability, 227                           |
| implementation in MongoDB, 46-48                  | serial transaction execution, 253         |
| machine learning, 428                             | in-memory representation of data, 112     |
| map-side processing, 408-410                      | random bit-flips in, 529                  |
| broadcast hash joins, 409                         | use by indexes, 72, 77                    |
| merge joins, 410                                  | memory barrier (CPU instruction), 338     |
| partitioned hash joins, 409                       | MemSQL (database)                         |
| mapper and reducer functions, 399                 | in-memory storage, 89                     |
| materialization of intermediate state,            | read committed isolation, 236             |
| 419-423                                           | memtable (in LSM-trees), 78               |
| output of batch workflows, 411-413                | Mercurial (version control system), 463   |
| building search indexes, 411                      | merge joins, MapReduce map-side, 410      |
| key-value stores, 412                             | mergeable persistent data structures, 174 |
| reduce-side processing, 403-408                   | merging sorted files, 76, 402, 405        |
| analysis of user activity events (exam‐           | Merkle trees, 532                         |
| ple), 404                                         | Mesos (cluster manager), 418, 506         |
| grouping records by same key, 406                 | message brokers (see messaging systems)   |
| handling skew, 407                                | message-passing, 136-139                  |
| sort-merge joins, 405                             | advantages over direct RPC, 137           |
| workflows, 402                                    | distributed actor frameworks, 138         |
| marshalling (see encoding)                        | evolvability, 138                         |
| massively parallel processing (MPP), 216          | MessagePack (encoding format), 116        |
| comparison to composing storage technolo‐         | messages                                  |
| gies, 502                                         | exactly-once semantics, 360, 476          |
| comparison to Hadoop, 414-418, 428                | loss of, 442                              |
| master-master replication (see multi-leader       | using total order broadcast, 348          |
| replication)                                      | messaging systems, 440-451                |
| master-slave replication (see leader-based repli‐ | (see also streams)                        |
| cation)                                           | backpressure, buffering, or dropping mes‐ |
| materialization, 556                              | sages, 441                                |
| aggregate values, 101                             | brokerless messaging, 442                 |
| conflicts, 251                                    | event logs, 446-451                       |
| intermediate state (batch processing),            | comparison to traditional messaging,      |
| 420-423                                           | 448, 451                                  |
| materialized views, 101                           | consumer offsets, 449                     |
| as derived data, 386, 499-504                     | replaying old messages, 451, 496, 498     |
| maintaining, using stream processing,             | slow consumers, 450                       |
| 467, 475                                          | message brokers, 443-446                  |
| Maven (Java build tool), 428                      | acknowledgements and redelivery, 445      |
| Maxwell (change data capture), 455                | comparison to event logs, 448, 451        |
| mean, 14                                          | multiple consumers of same topic, 444     |
| media monitoring, 467                             | reliability, 442                          |
| median, 14                                        | uniqueness in log-based messaging, 522    |

| Meteor (web framework), 456                   | replication topologies, 175-177               |
|-----------------------------------------------|-----------------------------------------------|
| microbatching, 477, 495                       | use cases, 168                                |
| microservices, 132                            | clients with offline operation, 170           |
| (see also services)                           | collaborative editing, 170                    |
| causal dependencies across services, 493      | multi-datacenter replication, 168, 335        |
| loose coupling, 502                           | multi-object transactions, 228                |
| relation to batch/stream processors, 389,     | need for, 231                                 |
| 508                                           | Multi-Paxos (total order broadcast), 367      |
| Microsoft                                     | multi-table index cluster tables (Oracle), 41 |
| Azure Service Bus (messaging), 444            | multi-tenancy, 284                            |
| Azure Storage, 155, 398                       | multi-version concurrency control (MVCC),     |
| Azure Stream Analytics, 466                   | 239, 266                                      |
| DCOM (Distributed Component Object            | detecting stale MVCC reads, 263               |
| Model), 134                                   | indexes and snapshot isolation, 241           |
| MSDTC (transaction coordinator), 356          | mutual exclusion, 261                         |
| Orleans (see Orleans)                         | (see also locks)                              |
| SQL Server (see SQL Server)                   | MySQL (database)                              |
| migrating (rewriting) data, 40, 130, 461, 497 | binlog coordinates, 156                       |
| modulus operator (%), 210                     | binlog parsing for change data capture, 455   |
| MongoDB (database)                            | circular replication topology, 175            |
| aggregation pipeline, 48                      | consistent snapshots, 156                     |
| atomic operations, 243                        | distributed transaction support, 361          |
| BSON, 41                                      | InnoDB storage engine (see InnoDB)            |
| document data model, 31                       | JSON support, 30, 42                          |
|                                               |                                               |
| hash partitioning (sharding), 203-204         | leader-based replication, 153                 |
| key-range partitioning, 202                   | performance of XA transactions, 360           |
| lack of join support, 34, 42                  | row-based replication, 160                    |
| leader-based replication, 153                 | schema changes in, 40                         |
| MapReduce support, 46, 400                    | snapshot isolation support, 242               |
| oplog parsing, 455, 456                       | (see also InnoDB)                             |
| partition splitting, 212                      | statement-based replication, 159              |
| request routing, 216                          | Tungsten Replicator (multi-leader replica‐    |
| secondary indexes, 207                        | tion), 170                                    |
| Mongoriver (change data capture), 455         | conflict detection, 177                       |
| monitoring, 10, 19                            |                                               |
| monotonic clocks, 288                         | N                                             |
| monotonic reads, 164                          | nanomsg (messaging library), 442              |
| MPP (see massively parallel processing)       | Narayana (transaction coordinator), 356       |
| MSMQ (messaging), 361                         | NATS (messaging), 137                         |
| multi-column indexes, 87                      | near-real-time (nearline) processing, 390     |
| multi-leader replication, 168-177             | (see also stream processing)                  |
| (see also replication)                        | Neo4j (database)                              |
| handling write conflicts, 171                 | Cypher query language, 52                     |
| conflict avoidance, 172                       | graph data model, 50                          |
| converging toward a consistent state,         | Nephele (dataflow engine), 421                |
| 172                                           | netcat (Unix tool), 397                       |
| custom conflict resolution logic, 173         |                                               |
| determining what is a conflict, 174           | Netflix Chaos Monkey, 7, 280                  |
| linearizability, lack of, 333                 | Network Attached Storage (NAS), 146, 398      |
|                                               | network model, 36                             |

| graph databases versus, 60                   | stateful, offline-capable clients, 170, 511   |
|----------------------------------------------|-----------------------------------------------|
| imperative query APIs, 46                    | offline-first applications, 511               |
| Network Time Protocol (see NTP)              | offsets                                       |
| networks                                     | consumer offsets in partitioned logs, 449     |
| congestion and queueing, 282                 | messages in partitioned logs, 447             |
| datacenter network topologies, 276           | OLAP (online analytic processing), 91, 556    |
| faults (see faults)                          | data cubes, 102                               |
| linearizability and network delays, 338      | OLTP (online transaction processing), 90, 556 |
| network partitions, 279, 337                 | analytics queries versus, 411                 |
| timeouts and unbounded delays, 281           | workload characteristics, 253                 |
| next-key locking, 260                        | one-to-many relationships, 30                 |
| nodes (in graphs) (see vertices)             | JSON representation, 32                       |
| nodes (processes), 556                       | online systems, 389                           |
| handling outages in leader-based replica‐    | (see also services)                           |
| tion, 156                                    | Oozie (workflow scheduler), 402               |
| system models for failure, 307               | OpenAPI (service definition format), 133      |
| noisy neighbors, 284                         | OpenStack                                     |
| nonblocking atomic commit, 359               | Nova (cloud infrastructure)                   |
| nondeterministic operations                  | use of ZooKeeper, 370                         |
| accidental nondeterminism, 423               | Swift (object storage), 398                   |
| partial failures in distributed systems, 275 | operability, 19                               |
| nonfunctional requirements, 22               | operating systems versus databases, 499       |
| nonrepeatable reads, 238                     | operation identifiers, 518, 522               |
| (see also read skew)                         | operational transformation, 174               |
| normalization (data representation), 33, 556 | operators, 421                                |
| executing joins, 39, 42, 403                 | flow of data between, 424                     |
| foreign key references, 231                  | in stream processing, 464                     |
| in systems of record, 386                    | optimistic concurrency control, 261           |
| versus denormalization, 462                  | Oracle (database)                             |
| NoSQL, 29, 499                               | distributed transaction support, 361          |
| transactions and, 223                        | GoldenGate (change data capture), 161,        |
| Notation3 (N3), 56                           | 170, 455                                      |
| npm (package manager), 428                   | lack of serializability, 226                  |
| NTP (Network Time Protocol), 287             | leader-based replication, 153                 |
| accuracy, 289, 293                           | multi-table index cluster tables, 41          |
| adjustments to monotonic clocks, 289         | not preventing write skew, 248                |
| multiple server addresses, 306               | partitioned indexes, 209                      |
| numbers, in XML and JSON encodings, 114      | PL/SQL language, 255                          |
|                                              | preventing lost updates, 245                  |
| O                                            | read committed isolation, 236                 |
|                                              | Real Application Clusters (RAC), 330          |
| object-relational mapping (ORM) frameworks,  | recursive query support, 54                   |
| 30                                           | snapshot isolation support, 239, 242          |
| error handling and aborted transactions,     | TimesTen (in-memory database), 89             |
| 232                                          | WAL-based replication, 160                    |
| unsafe read-modify-write cycle code, 244     | XML support, 30                               |
| object-relational mismatch, 29               | ordering, 339-352                             |
| observer pattern, 506                        | by sequence numbers, 343-348                  |
| offline systems, 390                         | causal ordering, 339-343                      |
| (see also batch processing)                  |                                               |

| partial order, 341                              | ballot number, 368                         |
|-------------------------------------------------|--------------------------------------------|
| limits of total ordering, 493                   | Multi-Paxos (total order broadcast), 367   |
| total order broadcast, 348-352                  | percentiles, 14, 556                       |
| Orleans (actor framework), 139                  | calculating efficiently, 16                |
| outliers (response time), 14                    | importance of high percentiles, 16         |
| Oz (programming language), 504                  | use in service level agreements (SLAs), 15 |
|                                                 | Percona XtraBackup (MySQL tool), 156       |
| P                                               | performance                                |
|                                                 | describing, 13                             |
| package managers, 428, 505                      | of distributed transactions, 360           |
| packet switching, 285                           | of in-memory databases, 89                 |
| packets                                         | of linearizability, 338                    |
| corruption of, 306                              | of multi-leader replication, 169           |
| sending via UDP, 442                            | perpetual inconsistency, 525               |
| PageRank (algorithm), 49, 424                   |                                            |
| paging (see virtual memory)                     | pessimistic concurrency control, 261       |
| ParAccel (database), 93                         | phantoms (transaction isolation), 250      |
| parallel databases (see massively parallel pro‐ | materializing conflicts, 251               |
| cessing)                                        | preventing, in serializability, 259        |
| parallel execution                              | physical clocks (see clocks)               |
| of graph analysis algorithms, 426               | pickle (Python), 113                       |
| queries in MPP databases, 216                   | Pig (dataflow language), 419, 427          |
| Parquet (data format), 96, 131                  | replicated joins, 409                      |
| (see also column-oriented storage)              | skewed joins, 407                          |
| use in Hadoop, 414                              | workflows, 403                             |
| partial failures, 275, 310                      | Pinball (workflow scheduler), 402          |
| limping, 311                                    | pipelined execution, 423                   |
| partial order, 341                              | in Unix, 394                               |
| partitioning, 199-218, 556                      | point in time, 287                         |
| and replication, 200                            | polyglot persistence, 29                   |
| in batch processing, 429                        | polystores, 501                            |
| multi-partition operations, 514                 | PostgreSQL (database)                      |
| enforcing constraints, 522                      | BDR (multi-leader replication), 170        |
| secondary index maintenance, 495                | causal ordering of writes, 177             |
| of key-value data, 201-205                      | Bottled Water (change data capture), 455   |
|                                                 | Bucardo (trigger-based replication), 161,  |
| by key range, 202                               | 173                                        |
| skew and hot spots, 205                         | distributed transaction support, 361       |
| rebalancing partitions, 209-214                 | foreign data wrappers, 501                 |
| automatic or manual rebalancing, 213            | full text search support, 490              |
| problems with hash mod N, 210                   | leader-based replication, 153              |
| using dynamic partitioning, 212                 | log sequence number, 156                   |
| using fixed number of partitions, 210           | MVCC implementation, 239, 241              |
| using N partitions per node, 212                | PL/pgSQL language, 255                     |
| replication and, 147                            | PostGIS geospatial indexes, 87             |
| request routing, 214-216                        |                                            |
| secondary indexes, 206-209                      | preventing lost updates, 245               |
| document-based partitioning, 206                | preventing write skew, 248, 261            |
| term-based partitioning, 208                    | read committed isolation, 236              |
| serial execution of transactions and, 255       | recursive query support, 54                |
| Paxos (consensus algorithm), 366                | representing graphs, 51                    |

| serializable snapshot isolation (SSI), 261 | pure functions, 48                              |
|--------------------------------------------|-------------------------------------------------|
| snapshot isolation support, 239, 242       | putting computation near data, 400              |
| WAL-based replication, 160                 |                                                 |
| XML and JSON support, 30, 42               | Q                                               |
| pre-splitting, 212                         |                                                 |
| Precision Time Protocol (PTP), 290         | Qpid (messaging), 444                           |
| predicate locks, 259                       | quality of service (QoS), 285                   |
| predictive analytics, 533-536              | Quantcast File System (distributed filesystem), |
| amplifying bias, 534                       | 398                                             |
| ethics of (see ethics)                     | query languages, 42-48                          |
| feedback loops, 536                        | aggregation pipeline, 48                        |
| preemption                                 | CSS and XSL, 44                                 |
| of datacenter resources, 418               | Cypher, 52                                      |
| of threads, 298                            | Datalog, 60                                     |
| Pregel processing model, 425               | Juttle, 504                                     |
| primary keys, 85, 556                      | MapReduce querying, 46-48                       |
| compound primary key (Cassandra), 204      | recursive SQL queries, 53                       |
| primary-secondary replication (see leader  | relational algebra and SQL, 42                  |
| based replication)                         | SPARQL, 59                                      |
| privacy, 536-543                           | query optimizers, 37, 427                       |
|                                            | queueing delays (networks), 282                 |
| consent and freedom of choice, 538         | head-of-line blocking, 15                       |
| data as assets and power, 540              | latency and response time, 14                   |
| deleting data, 463                         | queues (messaging), 137                         |
| ethical considerations (see ethics)        | quorums, 179-182, 556                           |
| legislation and self-regulation, 542       | for leaderless replication, 179                 |
| meaning of, 539                            | in consensus algorithms, 368                    |
| surveillance, 537                          | limitations of consistency, 181-183, 334        |
| tracking behavioral data, 536              | making decisions in distributed systems,        |
| probabilistic algorithms, 16, 466          | 301                                             |
| process pauses, 295-299                    | monitoring staleness, 182                       |
| processing time (of events), 469           | multi-datacenter replication, 184               |
| producers (message streams), 440           | relying on durability, 309                      |
| programming languages                      | sloppy quorums and hinted handoff, 183          |
| dataflow languages, 504                    |                                                 |
| for stored procedures, 255                 | R                                               |
| functional reactive programming (FRP),     |                                                 |
| 504                                        | R-trees (indexes), 87                           |
| logic programming, 504                     | RabbitMQ (messaging), 137, 444                  |
| Prolog (language), 61                      | leader-based replication, 153                   |
| (see also Datalog)                         | race conditions, 225                            |
| promises (asynchronous operations), 135    | (see also concurrency)                          |
| property graphs, 50                        | avoiding with linearizability, 331              |
| Cypher query language, 52                  | caused by dual writes, 452                      |
| Protocol Buffers (data format), 117-121    | dirty writes, 235                               |
| field tags and schema evolution, 120       | in counter increments, 235                      |
| provenance of data, 531                    | lost updates, 242-246                           |
| publish/subscribe model, 441               | preventing with event logs, 462, 507            |
| publishers (message streams), 440          | preventing with serializable isolation, 252     |
| punch card tabulating machines, 390        | write skew, 246-251                             |
|                                            | Raft (consensus algorithm), 366                 |

| sensitivity to network problems, 369         | events in stream processing, 440             |
|----------------------------------------------|----------------------------------------------|
| term number, 368                             | recursive common table expressions (SQL), 54 |
| use in etcd, 353                             | redelivery (messaging), 445                  |
| RAID (Redundant Array of Independent         | Redis (database)                             |
| Disks), 7, 398                               | atomic operations, 243                       |
| railways, schema migration on, 496           | durability, 89                               |
| RAMCloud (in-memory storage), 89             | Lua scripting, 255                           |
| ranking algorithms, 424                      | single-threaded execution, 253               |
| RDF (Resource Description Framework), 57     | usage example, 4                             |
| querying with SPARQL, 59                     | redundancy                                   |
| RDMA (Remote Direct Memory Access), 276      | hardware components, 7                       |
| read committed isolation level, 234-237      | of derived data, 386                         |
| implementing, 236                            | (see also derived data)                      |
| multi-version concurrency control            | Reed–Solomon codes (error correction), 398   |
| (MVCC), 239                                  | refactoring, 22                              |
| no dirty reads, 234                          | (see also evolvability)                      |
| no dirty writes, 235                         | regions (partitioning), 199                  |
| read path (derived data), 509                | register (data structure), 325               |
| read repair (leaderless replication), 178    | relational data model, 28-42                 |
| for linearizability, 335                     | comparison to document model, 38-42          |
| read replicas (see leader-based replication) | graph queries in SQL, 53                     |
| read skew (transaction isolation), 238, 266  | in-memory databases with, 89                 |
| as violation of causality, 340               | many-to-one and many-to-many relation‐       |
| read-after-write consistency, 163, 524       | ships, 33                                    |
| cross-device, 164                            | multi-object transactions, need for, 231     |
| read-modify-write cycle, 243                 | NoSQL as alternative to, 29                  |
| read-scaling architecture, 161               | object-relational mismatch, 29               |
| reads as events, 513                         | relational algebra and SQL, 42               |
| real-time                                    | versus document model                        |
| collaborative editing, 170                   | convergence of models, 41                    |
| near-real-time processing, 390               | data locality, 41                            |
| (see also stream processing)                 | relational databases                         |
| publish/subscribe dataflow, 513              | eventual consistency, 162                    |
| response time guarantees, 298                | history, 28                                  |
| time-of-day clocks, 288                      | leader-based replication, 153                |
| rebalancing partitions, 209-214, 556         | logical logs, 160                            |
| (see also partitioning)                      | philosophy compared to Unix, 499, 501        |
| automatic or manual rebalancing, 213         | schema changes, 40, 111, 130                 |
| dynamic partitioning, 212                    | statement-based replication, 158             |
| fixed number of partitions, 210              | use of B-tree indexes, 80                    |
| fixed number of partitions per node, 212     | relationships (see edges)                    |
| problems with hash mod N, 210                | reliability, 6-10, 489                       |
| recency guarantee, 324                       | building a reliable system from unreliable   |
| recommendation engines                       | components, 276                              |
| batch process outputs, 412                   | defined, 6, 22                               |
| batch workflows, 403, 420                    | hardware faults, 7                           |
| iterative processing, 424                    | human errors, 9                              |
| statistical and numerical algorithms, 428    | importance of, 10                            |
| records, 399                                 | of messaging systems, 442                    |
|                                              |                                              |

| software errors, 8                            | approaches to, 214                           |
|-----------------------------------------------|----------------------------------------------|
| Remote Method Invocation (Java RMI), 134      | parallel query execution, 216                |
| remote procedure calls (RPCs), 134-136        | resilient systems, 6                         |
| (see also services)                           | (see also fault tolerance)                   |
| based on futures, 135                         | response time                                |
| data encoding and evolution, 136              | as performance metric for services, 13, 389  |
| issues with, 134                              | guarantees on, 298                           |
| using Avro, 126, 135                          | latency versus, 14                           |
| using Thrift, 135                             | mean and percentiles, 14                     |
| versus message brokers, 137                   | user experience, 15                          |
| repeatable reads (transaction isolation), 242 | responsibility and accountability, 535       |
| replicas, 152                                 | REST (Representational State Transfer), 133  |
| replication, 151-193, 556                     | (see also services)                          |
| and durability, 227                           | RethinkDB (database)                         |
| chain replication, 155                        | document data model, 31                      |
| conflict resolution and, 246                  | dynamic partitioning, 212                    |
| consistency properties, 161-167               | join support, 34, 42                         |
| consistent prefix reads, 165                  | key-range partitioning, 202                  |
| monotonic reads, 164                          | leader-based replication, 153                |
| reading your own writes, 162                  | subscribing to changes, 456                  |
| in distributed filesystems, 398               | Riak (database)                              |
| leaderless, 177-191                           | Bitcask storage engine, 72                   |
| detecting concurrent writes, 184-191          | CRDTs, 174, 191                              |
| limitations of quorum consistency,            | dotted version vectors, 191                  |
| 181-183, 334                                  | gossip protocol, 216                         |
| sloppy quorums and hinted handoff, 183        | hash partitioning, 203-204, 211              |
| monitoring staleness, 182                     | last-write-wins conflict resolution, 186     |
| multi-leader, 168-177                         | leaderless replication, 177                  |
| across multiple datacenters, 168, 335         | LevelDB storage engine, 78                   |
| handling write conflicts, 171-175             | linearizability, lack of, 335                |
| replication topologies, 175-177               | multi-datacenter support, 184                |
| partitioning and, 147, 200                    | preventing lost updates across replicas, 246 |
| reasons for using, 145, 151                   | rebalancing, 213                             |
| single-leader, 152-161                        | search feature, 209                          |
| failover, 157                                 | secondary indexes, 207                       |
| implementation of replication logs,           | siblings (concurrently written values), 190  |
| 158-161                                       | sloppy quorums, 184                          |
| relation to consensus, 367                    | ring buffers, 450                            |
| setting up new followers, 155                 | Ripple (cryptocurrency), 532                 |
| synchronous versus asynchronous,              | rockets, 10, 36, 305                         |
| 153-155                                       | RocksDB (storage engine), 78                 |
| state machine replication, 349, 452           | leveled compaction, 79                       |
| using erasure coding, 398                     | rollbacks (transactions), 222                |
| with heterogeneous data systems, 453          | rolling upgrades, 8, 112                     |
| replication logs (see logs)                   | routing (see request routing)                |
| reprocessing data, 496, 498                   | row-oriented storage, 96                     |
| (see also evolvability)                       | row-based replication, 160                   |
| from log-based messaging, 451                 | rowhammer (memory corruption), 529           |
| request routing, 214-216                      | RPCs (see remote procedure calls)            |

| Rubygems (package manager), 428               | schema evolution, 120                        |
|-----------------------------------------------|----------------------------------------------|
| rules (Datalog), 61                           | traditional approach to design, fallacy in,  |
|                                               | 462                                          |
| S                                             | searches                                     |
|                                               | building search indexes in batch processes,  |
| safety and liveness properties, 308           | 411                                          |
| in consensus algorithms, 366                  | k-nearest neighbors, 429                     |
| in transactions, 222                          | on streams, 467                              |
| sagas (see compensating transactions)         |                                              |
| Samza (stream processor), 466, 467            | partitioned secondary indexes, 206           |
| fault tolerance, 479                          | secondaries (see leader-based replication)   |
| streaming SQL support, 466                    | secondary indexes, 85, 557                   |
| sandboxes, 9                                  | partitioning, 206-209, 217                   |
| SAP HANA (database), 93                       | document-partitioned, 206                    |
| scalability, 10-18, 489                       | index maintenance, 495                       |
| approaches for coping with load, 17           | term-partitioned, 208                        |
| defined, 22                                   | problems with dual writes, 452, 491          |
| describing load, 11                           | updating, transaction isolation and, 231     |
| describing performance, 13                    | secondary sorts, 405                         |
| partitioning and, 199                         | sed (Unix tool), 392                         |
| replication and, 161                          | self-describing files, 127                   |
| scaling up versus scaling out, 146            | self-joins, 480                              |
|                                               | self-validating systems, 530                 |
| scaling out, 17, 146                          | semantic web, 57                             |
| (see also shared-nothing architecture)        | semi-synchronous replication, 154            |
| scaling up, 17, 146                           | sequence number ordering, 343-348            |
| scatter/gather approach, querying partitioned | generators, 294, 344                         |
| databases, 207                                | insufficiency for enforcing constraints, 347 |
| SCD (slowly changing dimension), 476          | Lamport timestamps, 345                      |
| schema-on-read, 39                            | use of timestamps, 291, 295, 345             |
| comparison to evolvable schema, 128           |                                              |
| in distributed filesystems, 415               | sequential consistency, 351                  |
| schema-on-write, 39                           | serializability, 225, 233, 251-266, 557      |
| schemaless databases (see schema-on-read)     | linearizability versus, 329                  |
| schemas, 557                                  | pessimistic versus optimistic concurrency    |
| Avro, 122-127                                 | control, 261                                 |
| reader determining writer's schema, 125       | serial execution, 252-256                    |
| schema evolution, 123                         | partitioning, 255                            |
| dynamically generated, 126                    | using stored procedures, 253, 349            |
| evolution of, 496                             | serializable snapshot isolation (SSI),       |
| affecting application code, 111               | 261-266                                      |
| compatibility checking, 126                   | detecting stale MVCC reads, 263              |
| in databases, 129-131                         | detecting writes that affect prior reads,    |
| in message-passing, 138                       | 264                                          |
|                                               | distributed execution, 265, 364              |
| in service calls, 136                         | performance of SSI, 265                      |
| flexibility in document model, 39             | preventing write skew, 262-265               |
| for analytics, 93-95                          | two-phase locking (2PL), 257-261             |
| for JSON and XML, 115                         | index-range locks, 260                       |
| merits of, 127                                | performance, 258                             |
| schema migration on railways, 496             |                                              |
| Thrift and Protocol Buffers, 117-121          | Serializable (Java), 113                     |

| serialization, 113                               | clock skew, 291-294, 334                     |
|--------------------------------------------------|----------------------------------------------|
| (see also encoding)                              | in transaction isolation                     |
| service discovery, 135, 214, 372                 | read skew, 238, 266                          |
| using DNS, 216, 372                              | write skew, 246-251, 262-265                 |
| service level agreements (SLAs), 15              | (see also write skew)                        |
| service-oriented architecture (SOA), 132         | meanings of, 238                             |
| (see also services)                              | unbalanced workload, 201                     |
| services, 131-136                                | compensating for, 205                        |
| microservices, 132                               | due to celebrities, 205                      |
| causal dependencies across services, 493         | for time-series data, 203                    |
| loose coupling, 502                              | in batch processing, 407                     |
| relation to batch/stream processors, 389,        | slaves (see leader-based replication)        |
| 508                                              | sliding windows (stream processing), 472     |
| remote procedure calls (RPCs), 134-136           | (see also windows)                           |
| issues with, 134                                 | sloppy quorums, 183                          |
| similarity to databases, 132                     | (see also quorums)                           |
| web services, 132, 135                           | lack of linearizability, 334                 |
| session windows (stream processing), 472         | slowly changing dimension (data warehouses), |
| (see also windows)                               | 476                                          |
| sessionization, 407                              | smearing (leap seconds adjustments), 290     |
| sharding (see partitioning)                      | snapshots (databases)                        |
|                                                  |                                              |
| shared mode (locks), 258                         | causal consistency, 340                      |
| shared-disk architecture, 146, 398               | computing derived data, 500                  |
| shared-memory architecture, 146                  | in change data capture, 455                  |
| shared-nothing architecture, 17, 146-147, 557    | serializable snapshot isolation (SSI),       |
| (see also replication)                           | 261-266, 329                                 |
| distributed filesystems, 398                     | setting up a new replica, 156                |
| (see also distributed filesystems)               | snapshot isolation and repeatable read,      |
| partitioning, 199                                | 237-242                                      |
| use of network, 277                              | implementing with MVCC, 239                  |
| sharks                                           | indexes and MVCC, 241                        |
| biting undersea cables, 279                      | visibility rules, 240                        |
| counting (example), 46-48                        | synchronized clocks for global snapshots,    |
| finding (example), 42                            | 294                                          |
| website about (example), 44                      | snowflake schemas, 95                        |
| shredding (in relational model), 38              | SOAP, 133                                    |
| siblings (concurrent values), 190, 246           | (see also services)                          |
| (see also conflicts)                             | evolvability, 136                            |
| similarity search                                | software bugs, 8                             |
| edit distance, 88                                | maintaining integrity, 529                   |
| genome data, 63                                  | solid state drives (SSDs)                    |
| k-nearest neighbors, 429                         | access patterns, 84                          |
| single-leader replication (see leader-based rep‐ | detecting corruption, 519, 530               |
| lication)                                        | faults in, 227                               |
| single-threaded execution, 243, 252              | sequential write throughput, 75              |
| in batch processing, 406, 421, 426               | Solr (search server)                         |
| in stream processing, 448, 463, 522              | building indexes in batch processes, 411     |
| size-tiered compaction, 79                       | document-partitioned indexes, 207            |
| skew, 557                                        | request routing, 216                         |
|                                                  |                                              |

| usage example, 4                             | read committed isolation, 236                 |
|----------------------------------------------|-----------------------------------------------|
| use of Lucene, 79                            | recursive query support, 54                   |
| sort (Unix tool), 392, 394, 395              | serializable isolation, 257                   |
| sort-merge joins (MapReduce), 405            | snapshot isolation support, 239               |
| Sorted String Tables (see SSTables)          | T-SQL language, 255                           |
| sorting                                      | XML support, 30                               |
| sort order in column storage, 99             | SQLstream (stream analytics), 466             |
| source of truth (see systems of record)      | SSDs (see solid state drives)                 |
| Spanner (database)                           | SSTables (storage format), 76-79              |
| data locality, 41                            | advantages over hash indexes, 76              |
| snapshot isolation using clocks, 295         | concatenated index, 204                       |
| TrueTime API, 294                            | constructing and maintaining, 78              |
| Spark (processing framework), 421-423        | making LSM-Tree from, 78                      |
| bytecode generation, 428                     | staleness (old data), 162                     |
| dataflow APIs, 427                           | cross-channel timing dependencies, 331        |
| fault tolerance, 422                         | in leaderless databases, 178                  |
| for data warehouses, 93                      | in multi-version concurrency control, 263     |
| GraphX API (graph processing), 425           | monitoring for, 182                           |
| machine learning, 428                        | of client state, 512                          |
| query optimizer, 427                         | versus linearizability, 324                   |
| Spark Streaming, 466                         | versus timeliness, 524                        |
| microbatching, 477                           | standbys (see leader-based replication)       |
| stream processing on top of batch process‐   | star replication topologies, 175              |
| ing, 495                                     | star schemas, 93-95                           |
| SPARQL (query language), 59                  | similarity to event sourcing, 458             |
| spatial algorithms, 429                      | Star Wars analogy (event time versus process‐ |
| split brain, 158, 557                        | ing time), 469                                |
| in consensus algorithms, 352, 367            | state                                         |
| preventing, 322, 333                         | derived from log of immutable events, 459     |
| using fencing tokens to avoid, 302-304       | deriving current state from the event log,    |
| spreadsheets, dataflow programming capabili‐ | 458                                           |
| ties, 504                                    | interplay between state changes and appli‐    |
| SQL (Structured Query Language), 21, 28, 43  | cation code, 507                              |
| advantages and limitations of, 416           | maintaining derived state, 495                |
| distributed query execution, 48              | maintenance by stream processor in stream     |
| graph queries in, 53                         | stream joins, 473                             |
| isolation levels standard, issues with, 242  | observing derived state, 509-515              |
| query execution on Hadoop, 416               | rebuilding after stream processor failure,    |
| résumé (example), 30                         | 478                                           |
| SQL injection vulnerability, 305             | separation of application code and, 505       |
| SQL on Hadoop, 93                            | state machine replication, 349, 452           |
| statement-based replication, 158             | statement-based replication, 158              |
| stored procedures, 255                       | statically typed languages                    |
| SQL Server (database)                        | analogy to schema-on-write, 40                |
| data warehousing support, 93                 | code generation and, 127                      |
| distributed transaction support, 361         | statistical and numerical algorithms, 428     |
| leader-based replication, 153                | StatsD (metrics aggregator), 442              |
| preventing lost updates, 245                 | stdin, stdout, 395, 396                       |
|                                              |                                               |
| preventing write skew, 248, 257              | Stellar (cryptocurrency), 532                 |

| stock market feeds, 442                      | maintaining derived state, 495               |
|----------------------------------------------|----------------------------------------------|
| STONITH (Shoot The Other Node In The         | maintenance of materialized views, 467       |
| Head), 158                                   | messaging systems (see messaging systems)    |
| stop-the-world (see garbage collection)      | reasoning about time, 468-472                |
| storage                                      | event time versus processing time, 469,      |
| composing data storage technologies,         | 477, 498                                     |
| 499-504                                      | knowing when window is ready, 470            |
| diversity of, in MapReduce, 415              | types of windows, 472                        |
| Storage Area Network (SAN), 146, 398         | relation to databases (see streams)          |
| storage engines, 69-104                      | relation to services, 508                    |
| column-oriented, 95-101                      | search on streams, 467                       |
| column compression, 97-99                    | single-threaded execution, 448, 463          |
| defined, 96                                  | stream analytics, 466                        |
| distinction between column families          | stream joins, 472-476                        |
| and, 99                                      | stream-stream join, 473                      |
| Parquet, 96, 131                             | stream-table join, 473                       |
| sort order in, 99-100                        | table-table join, 474                        |
| writing to, 101                              | time-dependence of, 475                      |
| comparing requirements for transaction       | streams, 440-451                             |
| processing and analytics, 90-96              | end-to-end, pushing events to clients, 512   |
| in-memory storage, 88                        | messaging systems (see messaging systems)    |
| durability, 227                              | processing (see stream processing)           |
| row-oriented, 70-90                          | relation to databases, 451-464               |
| B-trees, 79-83                               | (see also changelogs)                        |
| comparing B-trees and LSM-trees, 83-85       | API support for change streams, 456          |
| defined, 96                                  | change data capture, 454-457                 |
| log-structured, 72-79                        | derivative of state by time, 460             |
| stored procedures, 161, 253-255, 557         | event sourcing, 457-459                      |
| and total order broadcast, 349               | keeping systems in sync, 452-453             |
| pros and cons of, 255                        | philosophy of immutable events,              |
| similarity to stream processors, 505         | 459-464                                      |
| Storm (stream processor), 466                | topics, 440                                  |
| distributed RPC, 468, 514                    | strict serializability, 329                  |
| Trident state handling, 478                  | strong consistency (see linearizability)     |
| straggler events, 470, 498                   | strong one-copy serializability, 329         |
| stream processing, 464-481, 557              | subjects, predicates, and objects (in triple |
| accessing external services within job, 474, | stores), 55                                  |
| 477, 478, 517                                | subscribers (message streams), 440           |
| combining with batch processing              | (see also consumers)                         |
| lambda architecture, 497                     | supercomputers, 275                          |
| unifying technologies, 498                   | surveillance, 537                            |
| comparison to batch processing, 464          | (see also privacy)                           |
| complex event processing (CEP), 465          | Swagger (service definition format), 133     |
| fault tolerance, 476-479                     | swapping to disk (see virtual memory)        |
| atomic commit, 477                           | synchronous networks, 285, 557               |
| idempotence, 478                             | comparison to asynchronous networks, 284     |
| microbatching and checkpointing, 477         | formal model, 307                            |
| rebuilding state after a failure, 478        | synchronous replication, 154, 557            |
| for data integration, 494-498                | chain replication, 155                       |
|                                              |                                              |

| conflict detection, 172                    | CompactProtocol, 119                         |
|--------------------------------------------|----------------------------------------------|
| system models, 300, 306-310                | field tags and schema evolution, 120         |
| assumptions in, 528                        | throughput, 13, 390                          |
| correctness of algorithms, 308             | TIBCO, 137                                   |
| mapping to the real world, 309             | Enterprise Message Service, 444              |
| safety and liveness, 308                   | StreamBase (stream analytics), 466           |
| systems of record, 386, 557                | time                                         |
| change data capture, 454, 491              | concurrency and, 187                         |
| treating event log as, 460                 | cross-channel timing dependencies, 331       |
| systems thinking, 536                      | in distributed systems, 287-299              |
|                                            | (see also clocks)                            |
|                                            | clock synchronization and accuracy, 289      |
| T                                          | relying on synchronized clocks, 291-295      |
| t-digest (algorithm), 16                   | process pauses, 295-299                      |
| table-table joins, 474                     | reasoning about, in stream processors,       |
| Tableau (data visualization software), 416 | 468-472                                      |
| tail (Unix tool), 447                      | event time versus processing time, 469,      |
| tail vertex (property graphs), 51          |                                              |
| Tajo (query engine), 93                    | 477, 498                                     |
| Tandem NonStop SQL (database), 200         | knowing when window is ready, 470            |
| TCP (Transmission Control Protocol), 277   | timestamp of events, 471                     |
| comparison to circuit switching, 285       | types of windows, 472                        |
| comparison to UDP, 283                     | system models for distributed systems, 307   |
| connection failures, 280                   | time-dependence in stream joins, 475         |
| flow control, 282, 441                     | time-of-day clocks, 288                      |
| packet checksums, 306, 519, 529            | timeliness, 524                              |
| reliability and duplicate suppression, 517 | coordination-avoiding data systems, 528      |
| retransmission timeouts, 284               | correctness of dataflow systems, 525         |
| use for transaction sessions, 229          | timeouts, 279, 557                           |
| telemetry (see monitoring)                 | dynamic configuration of, 284                |
| Teradata (database), 93, 200               | for failover, 158                            |
| term-partitioned indexes, 208, 217         | length of, 281                               |
| termination (consensus), 365               | timestamps, 343                              |
| Terrapin (database), 413                   | assigning to events in stream processing,    |
| Tez (dataflow engine), 421-423             | 471                                          |
| fault tolerance, 422                       | for read-after-write consistency, 163        |
| support by higher-level tools, 427         | for transaction ordering, 295                |
| thrashing (out of memory), 297             | insufficiency for enforcing constraints, 347 |
| threads (concurrency)                      | key range partitioning by, 203               |
| actor model, 138, 468                      | Lamport, 345                                 |
| (see also message-passing)                 | logical, 494                                 |
| atomic operations, 223                     | ordering events, 291, 345                    |
| background threads, 73, 85                 | Titan (database), 50                         |
| execution pauses, 286, 296-298             | tombstones, 74, 191, 456                     |
| memory barriers, 338                       | topics (messaging), 137, 440                 |
| preemption, 298                            | total order, 341, 557                        |
|                                            | limits of, 493                               |
| single (see single-threaded execution)     | sequence numbers or timestamps, 344          |
| three-phase commit, 359                    | total order broadcast, 348-352, 493, 522     |
| Thrift (data format), 117-121              | consensus algorithms and, 366-368            |
| BinaryProtocol, 118                        |                                              |

| implementation in ZooKeeper and etcd, 370    | triple-stores, 55-59                       |
|----------------------------------------------|--------------------------------------------|
| implementing with linearizable storage, 351  | SPARQL query language, 59                  |
| using, 349                                   | tumbling windows (stream processing), 472  |
| using to implement linearizable storage, 350 | (see also windows)                         |
| tracking behavioral data, 536                | in microbatching, 477                      |
| (see also privacy)                           | tuple spaces (programming model), 507      |
| transaction coordinator (see coordinator)    | Turtle (RDF data format), 56               |
| transaction manager (see coordinator)        | Twitter                                    |
| transaction processing, 28, 90-95            | constructing home timelines (example), 11, |
| comparison to analytics, 91                  | 462, 474, 511                              |
| comparison to data warehousing, 93           | DistributedLog (event log), 448            |
| transactions, 221-267, 558                   | Finagle (RPC framework), 135               |
| ACID properties of, 223                      | Snowflake (sequence number generator),     |
| atomicity, 223                               | 294                                        |
| consistency, 224                             | Summingbird (processing library), 497      |
| durability, 226                              | two-phase commit (2PC), 353, 355-359, 558  |
| isolation, 225                               | confusion with two-phase locking, 356      |
| compensating (see compensating transac‐      | coordinator failure, 358                   |
| tions)                                       | coordinator recovery, 363                  |
| concept of, 222                              | how it works, 357                          |
| distributed transactions, 352-364            | issues in practice, 363                    |
| avoiding, 492, 502, 521-528                  | performance cost, 360                      |
| failure amplification, 364, 495              | transactions holding locks, 362            |
| in doubt/uncertain status, 358, 362          | two-phase locking (2PL), 257-261, 329, 558 |
| two-phase commit, 354-359                    | confusion with two-phase commit, 356       |
| use of, 360-361                              | index-range locks, 260                     |
| XA transactions, 361-364                     | performance of, 258                        |
| OLTP versus analytics queries, 411           | type checking, dynamic versus static, 40   |
| purpose of, 222                              |                                            |
| serializability, 251-266                     |                                            |
| actual serial execution, 252-256             | U                                          |
| pessimistic versus optimistic concur‐        | UDP (User Datagram Protocol)               |
| rency control, 261                           | comparison to TCP, 283                     |
| serializable snapshot isolation (SSI),       | multicast, 442                             |
| 261-266                                      | unbounded datasets, 439, 558               |
| two-phase locking (2PL), 257-261             | (see also streams)                         |
| single-object and multi-object, 228-232      | unbounded delays, 558                      |
| handling errors and aborts, 231              | in networks, 282                           |
| need for multi-object transactions, 231      | process pauses, 296                        |
| single-object writes, 230                    | unbundling databases, 499-515              |
| snapshot isolation (see snapshots)           | composing data storage technologies,       |
| weak isolation levels, 233-251               | 499-504                                    |
| preventing lost updates, 242-246             | federation versus unbundling, 501          |
| read committed, 234-238                      | need for high-level language, 503          |
| transitive closure (graph algorithm), 424    | designing applications around dataflow,    |
| trie (data structure), 88                    | 504-509                                    |
| triggers (databases), 161, 441               | observing derived state, 509-515           |
| implementing change data capture, 455        | materialized views and caching, 510        |
| implementing replication, 161                | multi-partition data processing, 514       |
|                                              | pushing state changes to clients, 512      |

| uncertain (transaction status) (see in doubt)  | handling writes, 101                          |
|------------------------------------------------|-----------------------------------------------|
| uniform consensus, 365                         | replicas using different sort orders, 100     |
| (see also consensus)                           | vertical scaling (see scaling up)             |
| uniform interfaces, 395                        | vertices (in graphs), 49                      |
| union type (in Avro), 125                      | property graph model, 50                      |
| uniq (Unix tool), 392                          | Viewstamped Replication (consensus algo‐      |
| uniqueness constraints                         | rithm), 366                                   |
| asynchronously checked, 526                    | view number, 368                              |
| requiring consensus, 521                       | virtual machines, 146                         |
| requiring linearizability, 330                 | (see also cloud computing)                    |
| uniqueness in log-based messaging, 522         | context switches, 297                         |
| Unix philosophy, 394-397                       | network performance, 282                      |
| command-line batch processing, 391-394         | noisy neighbors, 284                          |
| Unix pipes versus dataflow engines, 423        | reliability in cloud services, 8              |
| comparison to Hadoop, 413-414                  | virtualized clocks in, 290                    |
| comparison to relational databases, 499, 501   | virtual memory                                |
| comparison to stream processing, 464           | process pauses due to page faults, 14, 297    |
| composability and uniform interfaces, 395      | versus memory management by databases,        |
| loose coupling, 396                            | 89                                            |
| pipes, 394                                     | VisiCalc (spreadsheets), 504                  |
| relation to Hadoop, 499                        | vnodes (partitioning), 199                    |
| UPDATE statement (SQL), 40                     | Voice over IP (VoIP), 283                     |
| updates                                        | Voldemort (database)                          |
| preventing lost updates, 242-246               | building read-only stores in batch processes, |
| atomic write operations, 243                   | 413                                           |
| automatically detecting lost updates, 245      | hash partitioning, 203-204, 211               |
| compare-and-set operations, 245                | leaderless replication, 177                   |
| conflict resolution and replication, 246       | multi-datacenter support, 184                 |
| using explicit locking, 244                    | rebalancing, 213                              |
| preventing write skew, 246-251                 | reliance on read repair, 179                  |
|                                                | sloppy quorums, 184                           |
| V                                              | VoltDB (database)                             |
|                                                | cross-partition serializability, 256          |
| validity (consensus), 365                      | deterministic stored procedures, 255          |
| vBuckets (partitioning), 199                   | in-memory storage, 89                         |
| vector clocks, 191                             | output streams, 456                           |
| (see also version vectors)                     | secondary indexes, 207                        |
| vectorized processing, 99, 428                 | serial execution of transactions, 253         |
| verification, 528-533                          | statement-based replication, 159, 479         |
| avoiding blind trust, 530                      | transactions in stream processing, 477        |
| culture of, 530                                |                                               |
| designing for auditability, 531                | W                                             |
| end-to-end integrity checks, 531               |                                               |
| tools for auditable data systems, 532          | WAL (write-ahead log), 82                     |
| version control systems, reliance on immutable | web services (see services)                   |
| data, 463                                      | Web Services Description Language (WSDL),     |
| version vectors, 177, 191                      | 133                                           |
| capturing causal dependencies, 343             | webhooks, 443                                 |
| versus vector clocks, 191                      | webMethods (messaging), 137                   |
| Vertica (database), 93                         | WebSocket (protocol), 512                     |

| windows (stream processing), 466, 468-472   | X                                             |
|---------------------------------------------|-----------------------------------------------|
| infinite windows for changelogs, 467, 474   | XA transactions, 355, 361-364                 |
| knowing when all events have arrived, 470   | heuristic decisions, 363                      |
| stream joins within a window, 473           | limitations of, 363                           |
| types of windows, 472                       | xargs (Unix tool), 392, 396                   |
| winners (conflict resolution), 173          | XML                                           |
| WITH RECURSIVE syntax (SQL), 54             | binary variants, 115<br>encoding RDF data, 57 |
| workflows (MapReduce), 402                  |                                               |
| outputs, 411-414                            | for application data, issues with, 114        |
| key-value stores, 412                       | in relational databases, 30, 41               |
| search indexes, 411                         | XSL/XPath, 45                                 |
| with map-side joins, 410                    |                                               |
| working set, 393                            |                                               |
| write amplification, 84                     | Y                                             |
| write path (derived data), 509              | Yahoo!                                        |
| write skew (transaction isolation), 246-251 | Pistachio (database), 461                     |
| characterizing, 246-251, 262                | Sherpa (database), 455                        |
| examples of, 247, 249                       | YARN (job scheduler), 416, 506                |
| materializing conflicts, 251                | preemption of jobs, 418                       |
| occurrence in practice, 529                 | use of ZooKeeper, 370                         |
| phantoms, 250                               |                                               |
| preventing                                  | Z                                             |
| in snapshot isolation, 262-265              | Zab (consensus algorithm), 366                |
| in two-phase locking, 259-261               | use in ZooKeeper, 353                         |
| options for, 248                            | ZeroMQ (messaging library), 442               |
| write-ahead log (WAL), 82, 159              | ZooKeeper (coordination service), 370-373     |
| writes (database)                           | generating fencing tokens, 303, 349, 370      |
| atomic write operations, 243                | linearizable operations, 333, 351             |
| detecting writes affecting prior reads, 264 | locks and leader election, 330                |
| preventing dirty writes with read commit‐   | service discovery, 372                        |
| ted, 235                                    | use for partition assignment, 215, 371        |
| WS-* framework, 133                         | use of Zab algorithm, 349, 353, 366           |
| (see also services)                         |                                               |
| WS-AtomicTransaction (2PC), 355             |                                               |

## **About the Author**

**Martin Kleppmann** is a researcher in distributed systems at the University of Cam‐ bridge, UK. Previously he was a software engineer and entrepreneur at internet com‐ panies including LinkedIn and Rapportive, where he worked on large-scale data infrastructure. In the process he learned a few things the hard way, and he hopes this book will save you from repeating the same mistakes.

Martin is a regular conference speaker, blogger, and open source contributor. He believes that profound technical ideas should be accessible to everyone, and that deeper understanding will help us develop better software.

## **Colophon**

The animal on the cover of *Designing Data-Intensive Applications* is an Indian wild boar (*Sus scrofa cristatus*), a subspecies of wild boar found in India, Myanmar, Nepal, Sri Lanka, and Thailand. They are distinctive from European boars in that they have higher back bristles, no woolly undercoat, and a larger, straighter skull.

The Indian wild boar has a coat of gray or black hair, with stiff bristles running along the spine. Males have protruding canine teeth (called tushes) that are used to fight with rivals or fend off predators. Males are larger than females, but the species aver‐ ages 33–35 inches tall at the shoulder and 200–300 pounds in weight. Their natural predators include bears, tigers, and various big cats.

These animals are nocturnal and omnivorous—they eat a wide variety of things, including roots, insects, carrion, nuts, berries, and small animals. Wild boars are also known to root through garbage and crop fields, causing a great deal of destruction and earning the enmity of farmers. They need to eat 4,000–4,500 calories a day. Boars have a well-developed sense of smell, which helps them forage for underground plant material and burrowing animals. However, their eyesight is poor.

Wild boars have long held significance in human culture. In Hindu lore, the boar is an avatar of the god Vishnu. In ancient Greek funerary monuments, it was a symbol of a gallant loser (in contrast to the victorious lion). Due to its aggression, it was depicted on the armor and weapons of Scandinavian, Germanic, and Anglo-Saxon warriors. In the Chinese zodiac, it symbolizes determination and impetuosity.

Many of the animals on O'Reilly covers are endangered; all of them are important to the world. To learn more about how you can help, go to *[animals.oreilly.com](http://animals.oreilly.com)*.

The cover image is from Shaw's *Zoology*. The cover fonts are URW Typewriter and Guardian Sans. The text font is Adobe Minion Pro; the font in diagrams is Adobe Myriad Pro; the heading font is Adobe Myriad Condensed; and the code font is Dal‐ ton Maag's Ubuntu Mono.